# TimeNest æ’ä»¶å¼€å‘æŒ‡å—

æ¬¢è¿æ¥åˆ° TimeNest æ’ä»¶å¼€å‘æŒ‡å—ï¼æœ¬æ–‡æ¡£å°†å¸®åŠ©æ‚¨ä»é›¶å¼€å§‹åˆ›å»ºåŠŸèƒ½å¼ºå¤§çš„ TimeNest æ’ä»¶ã€‚

## ğŸ“‹ ç›®å½•

- [æ’ä»¶ç³»ç»Ÿæ¶æ„](#æ’ä»¶ç³»ç»Ÿæ¶æ„)
- [å¼€å‘ç¯å¢ƒæ­å»º](#å¼€å‘ç¯å¢ƒæ­å»º)
- [æ’ä»¶ API æ¥å£](#æ’ä»¶-api-æ¥å£)
- [æ’ä»¶ç”Ÿå‘½å‘¨æœŸ](#æ’ä»¶ç”Ÿå‘½å‘¨æœŸ)
- [é…ç½®å’Œæ•°æ®å­˜å‚¨](#é…ç½®å’Œæ•°æ®å­˜å‚¨)
- [é€šä¿¡æœºåˆ¶](#é€šä¿¡æœºåˆ¶)
- [å¼€å‘æœ€ä½³å®è·µ](#å¼€å‘æœ€ä½³å®è·µ)
- [æµ‹è¯•å’Œè°ƒè¯•](#æµ‹è¯•å’Œè°ƒè¯•)
- [æ‰“åŒ…å’Œå‘å¸ƒ](#æ‰“åŒ…å’Œå‘å¸ƒ)
- [ç¤ºä¾‹æ’ä»¶](#ç¤ºä¾‹æ’ä»¶)
- [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

## ğŸ—ï¸ æ’ä»¶ç³»ç»Ÿæ¶æ„

### æ ¸å¿ƒç»„ä»¶

TimeNest æ’ä»¶ç³»ç»Ÿç”±ä»¥ä¸‹æ ¸å¿ƒç»„ä»¶æ„æˆï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    TimeNest ä¸»åº”ç”¨                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  PluginManager (æ’ä»¶ç®¡ç†å™¨)                                  â”‚
â”‚  â”œâ”€â”€ æ’ä»¶åŠ è½½å’Œå¸è½½                                          â”‚
â”‚  â”œâ”€â”€ ä¾èµ–å…³ç³»ç®¡ç†                                            â”‚
â”‚  â”œâ”€â”€ ç”Ÿå‘½å‘¨æœŸç®¡ç†                                            â”‚
â”‚  â””â”€â”€ å®‰å…¨æ²™ç®±æ§åˆ¶                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  PluginEventBus (äº‹ä»¶æ€»çº¿)                                   â”‚
â”‚  â”œâ”€â”€ äº‹ä»¶å‘å¸ƒå’Œè®¢é˜…                                          â”‚
â”‚  â”œâ”€â”€ æ’ä»¶é—´é€šä¿¡                                              â”‚
â”‚  â””â”€â”€ ä¸»ç¨‹åºé€šä¿¡                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  PluginMarketplace (æ’ä»¶å•†åŸ)                                â”‚
â”‚  â”œâ”€â”€ æ’ä»¶å‘ç°å’Œä¸‹è½½                                          â”‚
â”‚  â”œâ”€â”€ ç‰ˆæœ¬ç®¡ç†                                                â”‚
â”‚  â””â”€â”€ è‡ªåŠ¨æ›´æ–°                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                      æ’ä»¶å®ä¾‹                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚  ç»„ä»¶æ’ä»¶   â”‚ â”‚  é€šçŸ¥æ’ä»¶   â”‚ â”‚  ä¸»é¢˜æ’ä»¶   â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚  å¯¼å‡ºæ’ä»¶   â”‚ â”‚  é›†æˆæ’ä»¶   â”‚ â”‚  å·¥å…·æ’ä»¶   â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ’ä»¶ç±»å‹

TimeNest æ”¯æŒä»¥ä¸‹ç±»å‹çš„æ’ä»¶ï¼š

| ç±»å‹ | æè¿° | ç¤ºä¾‹ |
|------|------|------|
| **COMPONENT** | UI ç»„ä»¶æ’ä»¶ | å¤©æ°”ç»„ä»¶ã€å€’è®¡æ—¶ç»„ä»¶ |
| **NOTIFICATION** | é€šçŸ¥æ’ä»¶ | é‚®ä»¶é€šçŸ¥ã€å¾®ä¿¡é€šçŸ¥ |
| **THEME** | ä¸»é¢˜æ’ä»¶ | æ·±è‰²ä¸»é¢˜ã€èŠ‚æ—¥ä¸»é¢˜ |
| **EXPORT** | å¯¼å‡ºæ’ä»¶ | PDF å¯¼å‡ºã€Excel å¯¼å‡º |
| **INTEGRATION** | é›†æˆæ’ä»¶ | é’‰é’‰é›†æˆã€Teams é›†æˆ |
| **UTILITY** | å·¥å…·æ’ä»¶ | æ•°æ®åˆ†æã€å¤‡ä»½å·¥å…· |

### å®‰å…¨æœºåˆ¶

- **æ²™ç®±éš”ç¦»**ï¼šæ’ä»¶è¿è¡Œåœ¨å—é™ç¯å¢ƒä¸­
- **æƒé™æ§åˆ¶**ï¼šç»†ç²’åº¦çš„ API è®¿é—®æƒé™
- **ä»£ç ç­¾å**ï¼šéªŒè¯æ’ä»¶æ¥æºå’Œå®Œæ•´æ€§
- **èµ„æºé™åˆ¶**ï¼šé™åˆ¶å†…å­˜å’Œ CPU ä½¿ç”¨

## ğŸ› ï¸ å¼€å‘ç¯å¢ƒæ­å»º

### ç³»ç»Ÿè¦æ±‚

- **Python**: 3.8 æˆ–æ›´é«˜ç‰ˆæœ¬
- **PyQt6**: 6.6.0 æˆ–æ›´é«˜ç‰ˆæœ¬
- **TimeNest**: 1.0.0 æˆ–æ›´é«˜ç‰ˆæœ¬

### ç¯å¢ƒé…ç½®

1. **å…‹éš†å¼€å‘æ¨¡æ¿**
   ```bash
   git clone https://github.com/ziyi127/TimeNest-Plugin-Template.git my-plugin
   cd my-plugin
   ```

2. **å®‰è£…å¼€å‘ä¾èµ–**
   ```bash
   pip install -r requirements-dev.txt
   ```

3. **é…ç½®å¼€å‘ç¯å¢ƒ**
   ```bash
   # åˆ›å»ºæ’ä»¶å¼€å‘ç›®å½•
   mkdir -p ~/.timenest/plugins/my-plugin
   
   # é“¾æ¥åˆ°å¼€å‘ç›®å½•ï¼ˆç”¨äºè°ƒè¯•ï¼‰
   ln -s $(pwd) ~/.timenest/plugins/my-plugin
   ```

### å¼€å‘å·¥å…·

æ¨èä½¿ç”¨ä»¥ä¸‹å¼€å‘å·¥å…·ï¼š

- **IDE**: PyCharmã€VS Code
- **è°ƒè¯•å™¨**: TimeNest Plugin Debugger
- **æµ‹è¯•æ¡†æ¶**: pytest
- **ä»£ç æ£€æŸ¥**: flake8ã€mypy
- **æ–‡æ¡£ç”Ÿæˆ**: Sphinx

## ğŸ”Œ æ’ä»¶ API æ¥å£

### åŸºç¡€æ¥å£

æ‰€æœ‰æ’ä»¶å¿…é¡»ç»§æ‰¿ `IPlugin` æ¥å£ï¼š

```python
from abc import ABC, abstractmethod
from core.plugin_base import IPlugin, PluginMetadata, PluginStatus

class MyPlugin(IPlugin):
    """æˆ‘çš„æ’ä»¶"""
    
    def __init__(self):
        super().__init__()
        # è®¾ç½®æ’ä»¶å…ƒæ•°æ®
        self.metadata = PluginMetadata(
            id="my_plugin",
            name="æˆ‘çš„æ’ä»¶",
            version="1.0.0",
            description="è¿™æ˜¯ä¸€ä¸ªç¤ºä¾‹æ’ä»¶",
            author="Your Name",
            plugin_type=PluginType.UTILITY
        )
    
    def initialize(self, plugin_manager) -> bool:
        """åˆå§‹åŒ–æ’ä»¶"""
        self.plugin_manager = plugin_manager
        self.logger.info("æ’ä»¶åˆå§‹åŒ–å®Œæˆ")
        return True
    
    def activate(self) -> bool:
        """æ¿€æ´»æ’ä»¶"""
        self.logger.info("æ’ä»¶å·²æ¿€æ´»")
        return True
    
    def deactivate(self) -> bool:
        """åœç”¨æ’ä»¶"""
        self.logger.info("æ’ä»¶å·²åœç”¨")
        return True
    
    def cleanup(self) -> bool:
        """æ¸…ç†æ’ä»¶èµ„æº"""
        self.logger.info("æ’ä»¶èµ„æºå·²æ¸…ç†")
        return True
```

### æ ¸å¿ƒ API

#### 1. åº”ç”¨ç®¡ç†å™¨ API

```python
# è·å–åº”ç”¨ç®¡ç†å™¨
app_manager = self.plugin_manager.get_app_manager()

# è·å–ä¸»çª—å£
main_window = app_manager.get_main_window()

# è·å–ç³»ç»Ÿæ‰˜ç›˜
system_tray = app_manager.get_system_tray()
```

#### 2. é…ç½®ç®¡ç† API

```python
# è·å–é…ç½®ç®¡ç†å™¨
config_manager = self.plugin_manager.get_config_manager()

# è¯»å–é…ç½®
value = config_manager.get_config('key', default_value)

# ä¿å­˜é…ç½®
config_manager.set_config('key', value)
```

#### 3. é€šçŸ¥ç³»ç»Ÿ API

```python
# è·å–é€šçŸ¥ç®¡ç†å™¨
notification_manager = self.plugin_manager.get_notification_manager()

# å‘é€é€šçŸ¥
notification_manager.send_notification(
    title="æ’ä»¶é€šçŸ¥",
    message="è¿™æ˜¯æ¥è‡ªæ’ä»¶çš„é€šçŸ¥",
    channels=['popup', 'sound']
)
```

#### 4. äº‹ä»¶ç³»ç»Ÿ API

```python
# è·å–äº‹ä»¶æ€»çº¿
event_bus = self.plugin_manager.get_event_bus()

# è®¢é˜…äº‹ä»¶
event_bus.subscribe('schedule_changed', self.on_schedule_changed)

# å‘å¸ƒäº‹ä»¶
from core.plugin_system import PluginEvent
event = PluginEvent('my_event', {'data': 'value'}, self.metadata.id)
event_bus.publish(event)

def on_schedule_changed(self, event):
    """å¤„ç†è¯¾ç¨‹è¡¨å˜æ›´äº‹ä»¶"""
    self.logger.info(f"è¯¾ç¨‹è¡¨å·²å˜æ›´: {event.data}")
```

### UI ç»„ä»¶ API

#### 1. æµ®çª—ç»„ä»¶

```python
from PyQt6.QtWidgets import QWidget, QLabel, QVBoxLayout

class MyFloatingWidget(QWidget):
    """è‡ªå®šä¹‰æµ®çª—ç»„ä»¶"""
    
    def __init__(self):
        super().__init__()
        self.setup_ui()
    
    def setup_ui(self):
        layout = QVBoxLayout()
        label = QLabel("æˆ‘çš„æ’ä»¶ç»„ä»¶")
        layout.addWidget(label)
        self.setLayout(layout)

# åœ¨æ’ä»¶ä¸­æ³¨å†Œç»„ä»¶
def activate(self) -> bool:
    floating_manager = self.plugin_manager.get_floating_manager()
    self.widget = MyFloatingWidget()
    floating_manager.add_component('my_plugin_widget', self.widget)
    return True
```

#### 2. èœå•é¡¹

```python
def activate(self) -> bool:
    # æ·»åŠ èœå•é¡¹
    main_window = self.plugin_manager.get_main_window()
    menu_bar = main_window.menuBar()
    
    # åˆ›å»ºæ’ä»¶èœå•
    plugin_menu = menu_bar.addMenu("æˆ‘çš„æ’ä»¶")
    
    # æ·»åŠ åŠ¨ä½œ
    action = plugin_menu.addAction("æ‰§è¡Œæ“ä½œ")
    action.triggered.connect(self.execute_action)
    
    return True

def execute_action(self):
    """æ‰§è¡Œæ’ä»¶åŠ¨ä½œ"""
    self.logger.info("æ‰§è¡Œæ’ä»¶åŠ¨ä½œ")
```

## ğŸ”„ æ’ä»¶ç”Ÿå‘½å‘¨æœŸ

### ç”Ÿå‘½å‘¨æœŸé˜¶æ®µ

```mermaid
graph TD
    A[æ’ä»¶å‘ç°] --> B[åŠ è½½æ’ä»¶]
    B --> C[åˆå§‹åŒ–]
    C --> D[æ¿€æ´»]
    D --> E[è¿è¡Œä¸­]
    E --> F[åœç”¨]
    F --> G[æ¸…ç†]
    G --> H[å¸è½½]
    
    E --> I[é‡æ–°æ¿€æ´»]
    I --> E
    
    C --> J[åˆå§‹åŒ–å¤±è´¥]
    J --> G
    
    D --> K[æ¿€æ´»å¤±è´¥]
    K --> G
```

### ç”Ÿå‘½å‘¨æœŸæ–¹æ³•

1. **initialize(plugin_manager)**: æ’ä»¶åˆå§‹åŒ–
   - è®¾ç½®æ’ä»¶ç®¡ç†å™¨å¼•ç”¨
   - åˆå§‹åŒ–æ’ä»¶èµ„æº
   - æ³¨å†Œäº‹ä»¶ç›‘å¬å™¨
   - è¿”å› True è¡¨ç¤ºæˆåŠŸ

2. **activate()**: æ’ä»¶æ¿€æ´»
   - å¯åŠ¨æ’ä»¶åŠŸèƒ½
   - æ³¨å†Œ UI ç»„ä»¶
   - å¼€å§‹åå°ä»»åŠ¡
   - è¿”å› True è¡¨ç¤ºæˆåŠŸ

3. **deactivate()**: æ’ä»¶åœç”¨
   - åœæ­¢åå°ä»»åŠ¡
   - ç§»é™¤ UI ç»„ä»¶
   - ä¿å­˜çŠ¶æ€æ•°æ®
   - è¿”å› True è¡¨ç¤ºæˆåŠŸ

4. **cleanup()**: æ’ä»¶æ¸…ç†
   - é‡Šæ”¾èµ„æº
   - å–æ¶ˆäº‹ä»¶è®¢é˜…
   - æ¸…ç†ä¸´æ—¶æ–‡ä»¶
   - è¿”å› True è¡¨ç¤ºæˆåŠŸ

### çŠ¶æ€ç®¡ç†

æ’ä»¶çŠ¶æ€ç”± `PluginStatus` æšä¸¾å®šä¹‰ï¼š

```python
class PluginStatus(Enum):
    UNKNOWN = "unknown"      # æœªçŸ¥çŠ¶æ€
    LOADED = "loaded"        # å·²åŠ è½½
    ENABLED = "enabled"      # å·²å¯ç”¨
    DISABLED = "disabled"    # å·²ç¦ç”¨
    ERROR = "error"          # é”™è¯¯çŠ¶æ€
```

## ğŸ’¾ é…ç½®å’Œæ•°æ®å­˜å‚¨

### æ’ä»¶é…ç½®

#### 1. é…ç½®æ–‡ä»¶ç»“æ„

```json
{
  "my_plugin": {
    "enabled": true,
    "settings": {
      "refresh_interval": 60,
      "show_notifications": true,
      "api_key": "your_api_key"
    },
    "ui": {
      "position": {"x": 100, "y": 100},
      "size": {"width": 200, "height": 150},
      "theme": "default"
    }
  }
}
```

#### 2. é…ç½®ç®¡ç†

```python
class MyPlugin(IPlugin):
    def __init__(self):
        super().__init__()
        self.config = {}
    
    def initialize(self, plugin_manager) -> bool:
        self.plugin_manager = plugin_manager
        self.load_config()
        return True
    
    def load_config(self):
        """åŠ è½½æ’ä»¶é…ç½®"""
        self.config = self.plugin_manager.get_plugin_config(self.metadata.id)
        
        # è®¾ç½®é»˜è®¤å€¼
        default_config = {
            'enabled': True,
            'refresh_interval': 60,
            'show_notifications': True
        }
        
        for key, value in default_config.items():
            if key not in self.config:
                self.config[key] = value
    
    def save_config(self):
        """ä¿å­˜æ’ä»¶é…ç½®"""
        self.plugin_manager.set_plugin_config(self.metadata.id, self.config)
    
    def get_setting(self, key: str, default=None):
        """è·å–è®¾ç½®å€¼"""
        return self.config.get(key, default)
    
    def set_setting(self, key: str, value):
        """è®¾ç½®é…ç½®å€¼"""
        self.config[key] = value
        self.save_config()
```

### æ•°æ®å­˜å‚¨

#### 1. æœ¬åœ°æ•°æ®å­˜å‚¨

```python
import json
from pathlib import Path

class MyPlugin(IPlugin):
    def __init__(self):
        super().__init__()
        self.data_dir = Path.home() / '.timenest' / 'plugins' / 'my_plugin' / 'data'
        self.data_dir.mkdir(parents=True, exist_ok=True)
    
    def save_data(self, filename: str, data: dict):
        """ä¿å­˜æ•°æ®åˆ°æ–‡ä»¶"""
        file_path = self.data_dir / filename
        with open(file_path, 'w', encoding='utf-8') as f:
            json.dump(data, f, ensure_ascii=False, indent=2)
    
    def load_data(self, filename: str) -> dict:
        """ä»æ–‡ä»¶åŠ è½½æ•°æ®"""
        file_path = self.data_dir / filename
        if file_path.exists():
            with open(file_path, 'r', encoding='utf-8') as f:
                return json.load(f)
        return {}
```

#### 2. æ•°æ®åº“å­˜å‚¨

```python
import sqlite3
from pathlib import Path

class MyPlugin(IPlugin):
    def __init__(self):
        super().__init__()
        self.db_path = Path.home() / '.timenest' / 'plugins' / 'my_plugin' / 'data.db'
        self.init_database()
    
    def init_database(self):
        """åˆå§‹åŒ–æ•°æ®åº“"""
        self.db_path.parent.mkdir(parents=True, exist_ok=True)
        
        with sqlite3.connect(self.db_path) as conn:
            conn.execute('''
                CREATE TABLE IF NOT EXISTS plugin_data (
                    id INTEGER PRIMARY KEY AUTOINCREMENT,
                    key TEXT UNIQUE NOT NULL,
                    value TEXT NOT NULL,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                )
            ''')
    
    def save_to_db(self, key: str, value: str):
        """ä¿å­˜æ•°æ®åˆ°æ•°æ®åº“"""
        with sqlite3.connect(self.db_path) as conn:
            conn.execute('''
                INSERT OR REPLACE INTO plugin_data (key, value, updated_at)
                VALUES (?, ?, CURRENT_TIMESTAMP)
            ''', (key, value))
    
    def load_from_db(self, key: str) -> str:
        """ä»æ•°æ®åº“åŠ è½½æ•°æ®"""
        with sqlite3.connect(self.db_path) as conn:
            cursor = conn.execute('SELECT value FROM plugin_data WHERE key = ?', (key,))
            result = cursor.fetchone()
            return result[0] if result else None


## ğŸ”— é€šä¿¡æœºåˆ¶

### äº‹ä»¶é©±åŠ¨é€šä¿¡

TimeNest æ’ä»¶ç³»ç»Ÿä½¿ç”¨äº‹ä»¶é©±åŠ¨æ¶æ„è¿›è¡Œé€šä¿¡ï¼š

#### 1. ç³»ç»Ÿäº‹ä»¶

ç³»ç»Ÿä¼šå‘å¸ƒä»¥ä¸‹æ ‡å‡†äº‹ä»¶ï¼š

| äº‹ä»¶åç§° | æè¿° | æ•°æ®æ ¼å¼ |
|----------|------|----------|
| `app_started` | åº”ç”¨å¯åŠ¨ | `{}` |
| `app_closing` | åº”ç”¨å…³é—­ | `{}` |
| `schedule_loaded` | è¯¾ç¨‹è¡¨åŠ è½½ | `{'file_path': str}` |
| `schedule_changed` | è¯¾ç¨‹è¡¨å˜æ›´ | `{'changes': list}` |
| `class_started` | è¯¾ç¨‹å¼€å§‹ | `{'class_info': dict}` |
| `class_ended` | è¯¾ç¨‹ç»“æŸ | `{'class_info': dict}` |
| `notification_sent` | é€šçŸ¥å‘é€ | `{'notification': dict}` |
| `theme_changed` | ä¸»é¢˜å˜æ›´ | `{'theme_name': str}` |

#### 2. äº‹ä»¶è®¢é˜…

```python
def initialize(self, plugin_manager) -> bool:
    self.plugin_manager = plugin_manager
    event_bus = plugin_manager.get_event_bus()

    # è®¢é˜…ç³»ç»Ÿäº‹ä»¶
    event_bus.subscribe('class_started', self.on_class_started)
    event_bus.subscribe('schedule_changed', self.on_schedule_changed)

    return True

def on_class_started(self, event):
    """å¤„ç†è¯¾ç¨‹å¼€å§‹äº‹ä»¶"""
    class_info = event.data.get('class_info', {})
    self.logger.info(f"è¯¾ç¨‹å¼€å§‹: {class_info.get('name', 'æœªçŸ¥è¯¾ç¨‹')}")

    # æ ‡è®°äº‹ä»¶å·²å¤„ç†ï¼ˆå¯é€‰ï¼‰
    event.mark_handled()

def on_schedule_changed(self, event):
    """å¤„ç†è¯¾ç¨‹è¡¨å˜æ›´äº‹ä»¶"""
    changes = event.data.get('changes', [])
    self.logger.info(f"è¯¾ç¨‹è¡¨å˜æ›´: {len(changes)} é¡¹å˜æ›´")
```

#### 3. è‡ªå®šä¹‰äº‹ä»¶

```python
from core.plugin_system import PluginEvent

def send_custom_event(self):
    """å‘é€è‡ªå®šä¹‰äº‹ä»¶"""
    event_bus = self.plugin_manager.get_event_bus()

    # åˆ›å»ºè‡ªå®šä¹‰äº‹ä»¶
    event = PluginEvent(
        event_type='my_plugin_action',
        data={'action': 'data_updated', 'timestamp': time.time()},
        source_plugin=self.metadata.id
    )

    # å‘å¸ƒäº‹ä»¶
    event_bus.publish(event)
```

### æ’ä»¶é—´é€šä¿¡

#### 1. ç›´æ¥è°ƒç”¨

```python
def communicate_with_other_plugin(self):
    """ä¸å…¶ä»–æ’ä»¶é€šä¿¡"""
    # è·å–å…¶ä»–æ’ä»¶å®ä¾‹
    other_plugin = self.plugin_manager.get_plugin('other_plugin_id')

    if other_plugin and other_plugin.status == PluginStatus.ENABLED:
        # ç›´æ¥è°ƒç”¨å…¶ä»–æ’ä»¶çš„æ–¹æ³•
        if hasattr(other_plugin, 'get_data'):
            data = other_plugin.get_data()
            self.logger.info(f"ä»å…¶ä»–æ’ä»¶è·å–æ•°æ®: {data}")
```

#### 2. å…±äº«æ•°æ®

```python
def share_data(self):
    """å…±äº«æ•°æ®ç»™å…¶ä»–æ’ä»¶"""
    # é€šè¿‡æ’ä»¶ç®¡ç†å™¨å…±äº«æ•°æ®
    shared_data = {'key': 'value', 'timestamp': time.time()}
    self.plugin_manager.set_shared_data(self.metadata.id, shared_data)

def get_shared_data(self):
    """è·å–å…¶ä»–æ’ä»¶å…±äº«çš„æ•°æ®"""
    data = self.plugin_manager.get_shared_data('other_plugin_id')
    return data
```

## ğŸ¯ å¼€å‘æœ€ä½³å®è·µ

### ä»£ç è§„èŒƒ

#### 1. å‘½åè§„èŒƒ

```python
# æ’ä»¶ç±»åï¼šä½¿ç”¨ PascalCase
class WeatherWidgetPlugin(IPlugin):
    pass

# æ–¹æ³•åï¼šä½¿ç”¨ snake_case
def get_weather_data(self):
    pass

# å¸¸é‡ï¼šä½¿ç”¨ UPPER_CASE
DEFAULT_REFRESH_INTERVAL = 60
API_ENDPOINT = "https://api.weather.com"

# ç§æœ‰æ–¹æ³•ï¼šä½¿ç”¨ä¸‹åˆ’çº¿å‰ç¼€
def _validate_api_key(self):
    pass
```

#### 2. æ–‡æ¡£å­—ç¬¦ä¸²

```python
class WeatherPlugin(IPlugin):
    """
    å¤©æ°”æ’ä»¶

    æä¾›å®æ—¶å¤©æ°”ä¿¡æ¯æ˜¾ç¤ºåŠŸèƒ½ï¼Œæ”¯æŒå¤šä¸ªåŸå¸‚å’Œè‡ªå®šä¹‰åˆ·æ–°é—´éš”ã€‚

    Attributes:
        api_key (str): å¤©æ°” API å¯†é’¥
        refresh_interval (int): åˆ·æ–°é—´éš”ï¼ˆç§’ï¼‰
        cities (List[str]): ç›‘æ§çš„åŸå¸‚åˆ—è¡¨
    """

    def get_weather_data(self, city: str) -> dict:
        """
        è·å–æŒ‡å®šåŸå¸‚çš„å¤©æ°”æ•°æ®

        Args:
            city (str): åŸå¸‚åç§°

        Returns:
            dict: åŒ…å«å¤©æ°”ä¿¡æ¯çš„å­—å…¸

        Raises:
            APIError: API è°ƒç”¨å¤±è´¥æ—¶æŠ›å‡º
            ValueError: åŸå¸‚åç§°æ— æ•ˆæ—¶æŠ›å‡º
        """
        pass
```

#### 3. é”™è¯¯å¤„ç†

```python
def fetch_weather_data(self, city: str) -> Optional[dict]:
    """è·å–å¤©æ°”æ•°æ®"""
    try:
        response = requests.get(
            f"{self.api_endpoint}/weather",
            params={'city': city, 'key': self.api_key},
            timeout=10
        )
        response.raise_for_status()
        return response.json()

    except requests.exceptions.Timeout:
        self.logger.error(f"è·å–å¤©æ°”æ•°æ®è¶…æ—¶: {city}")
        return None

    except requests.exceptions.HTTPError as e:
        self.logger.error(f"HTTP é”™è¯¯: {e}")
        return None

    except requests.exceptions.RequestException as e:
        self.logger.error(f"è¯·æ±‚å¼‚å¸¸: {e}")
        return None

    except json.JSONDecodeError:
        self.logger.error("å“åº”æ•°æ®æ ¼å¼é”™è¯¯")
        return None

    except Exception as e:
        self.logger.error(f"æœªçŸ¥é”™è¯¯: {e}")
        return None
```

### æ€§èƒ½ä¼˜åŒ–

#### 1. å¼‚æ­¥æ“ä½œ

```python
import asyncio
from PyQt6.QtCore import QThread, pyqtSignal

class AsyncWorker(QThread):
    """å¼‚æ­¥å·¥ä½œçº¿ç¨‹"""

    data_ready = pyqtSignal(dict)
    error_occurred = pyqtSignal(str)

    def __init__(self, plugin):
        super().__init__()
        self.plugin = plugin

    def run(self):
        """æ‰§è¡Œå¼‚æ­¥ä»»åŠ¡"""
        try:
            # æ‰§è¡Œè€—æ—¶æ“ä½œ
            data = self.plugin.fetch_data()
            self.data_ready.emit(data)

        except Exception as e:
            self.error_occurred.emit(str(e))

# åœ¨æ’ä»¶ä¸­ä½¿ç”¨
def start_async_task(self):
    """å¯åŠ¨å¼‚æ­¥ä»»åŠ¡"""
    self.worker = AsyncWorker(self)
    self.worker.data_ready.connect(self.on_data_ready)
    self.worker.error_occurred.connect(self.on_error)
    self.worker.start()

def on_data_ready(self, data):
    """å¤„ç†å¼‚æ­¥æ•°æ®"""
    self.update_ui(data)
```

#### 2. ç¼“å­˜æœºåˆ¶

```python
import time
from functools import lru_cache

class WeatherPlugin(IPlugin):
    def __init__(self):
        super().__init__()
        self.cache = {}
        self.cache_ttl = 300  # 5åˆ†é’Ÿç¼“å­˜

    def get_weather_data(self, city: str) -> dict:
        """è·å–å¤©æ°”æ•°æ®ï¼ˆå¸¦ç¼“å­˜ï¼‰"""
        cache_key = f"weather_{city}"
        current_time = time.time()

        # æ£€æŸ¥ç¼“å­˜
        if cache_key in self.cache:
            cached_data, timestamp = self.cache[cache_key]
            if current_time - timestamp < self.cache_ttl:
                return cached_data

        # è·å–æ–°æ•°æ®
        data = self.fetch_weather_data(city)
        if data:
            self.cache[cache_key] = (data, current_time)

        return data

    @lru_cache(maxsize=128)
    def get_city_coordinates(self, city: str) -> tuple:
        """è·å–åŸå¸‚åæ ‡ï¼ˆä½¿ç”¨ LRU ç¼“å­˜ï¼‰"""
        # å®ç°åŸå¸‚åæ ‡æŸ¥è¯¢
        pass
```

#### 3. èµ„æºç®¡ç†

```python
class ResourceManager:
    """èµ„æºç®¡ç†å™¨"""

    def __init__(self):
        self.resources = {}
        self.timers = []

    def add_timer(self, timer):
        """æ·»åŠ å®šæ—¶å™¨"""
        self.timers.append(timer)

    def cleanup(self):
        """æ¸…ç†æ‰€æœ‰èµ„æº"""
        # åœæ­¢å®šæ—¶å™¨
        for timer in self.timers:
            if timer.isActive():
                timer.stop()
        self.timers.clear()

        # æ¸…ç†å…¶ä»–èµ„æº
        for resource in self.resources.values():
            if hasattr(resource, 'cleanup'):
                resource.cleanup()
        self.resources.clear()

# åœ¨æ’ä»¶ä¸­ä½¿ç”¨
def initialize(self, plugin_manager) -> bool:
    self.resource_manager = ResourceManager()
    return True

def cleanup(self) -> bool:
    self.resource_manager.cleanup()
    return True
```

### å®‰å…¨è€ƒè™‘

#### 1. è¾“å…¥éªŒè¯

```python
def validate_input(self, data: dict) -> bool:
    """éªŒè¯è¾“å…¥æ•°æ®"""
    required_fields = ['city', 'api_key']

    # æ£€æŸ¥å¿…éœ€å­—æ®µ
    for field in required_fields:
        if field not in data:
            self.logger.error(f"ç¼ºå°‘å¿…éœ€å­—æ®µ: {field}")
            return False

    # éªŒè¯æ•°æ®ç±»å‹
    if not isinstance(data['city'], str):
        self.logger.error("åŸå¸‚åç§°å¿…é¡»æ˜¯å­—ç¬¦ä¸²")
        return False

    # éªŒè¯æ•°æ®é•¿åº¦
    if len(data['city']) > 100:
        self.logger.error("åŸå¸‚åç§°è¿‡é•¿")
        return False

    # éªŒè¯ç‰¹æ®Šå­—ç¬¦
    import re
    if not re.match(r'^[a-zA-Z\s\-]+$', data['city']):
        self.logger.error("åŸå¸‚åç§°åŒ…å«æ— æ•ˆå­—ç¬¦")
        return False

    return True
```

#### 2. æƒé™æ§åˆ¶

```python
def check_permissions(self) -> bool:
    """æ£€æŸ¥æ’ä»¶æƒé™"""
    required_permissions = ['network_access', 'file_read']

    for permission in required_permissions:
        if not self.plugin_manager.has_permission(self.metadata.id, permission):
            self.logger.error(f"ç¼ºå°‘æƒé™: {permission}")
            return False

    return True
```

## ğŸ§ª æµ‹è¯•å’Œè°ƒè¯•

### å•å…ƒæµ‹è¯•

#### 1. æµ‹è¯•æ¡†æ¶è®¾ç½®

```python
# tests/test_my_plugin.py
import pytest
import sys
from pathlib import Path
from unittest.mock import Mock, patch

# æ·»åŠ æ’ä»¶è·¯å¾„
plugin_path = Path(__file__).parent.parent
sys.path.insert(0, str(plugin_path))

from main import MyPlugin
from core.plugin_system import PluginManager

class TestMyPlugin:
    """æ’ä»¶æµ‹è¯•ç±»"""

    def setup_method(self):
        """æµ‹è¯•å‰å‡†å¤‡"""
        self.plugin = MyPlugin()
        self.mock_plugin_manager = Mock(spec=PluginManager)

    def test_initialize(self):
        """æµ‹è¯•æ’ä»¶åˆå§‹åŒ–"""
        result = self.plugin.initialize(self.mock_plugin_manager)
        assert result is True
        assert self.plugin.plugin_manager == self.mock_plugin_manager

    def test_activate(self):
        """æµ‹è¯•æ’ä»¶æ¿€æ´»"""
        self.plugin.initialize(self.mock_plugin_manager)
        result = self.plugin.activate()
        assert result is True

    def test_deactivate(self):
        """æµ‹è¯•æ’ä»¶åœç”¨"""
        self.plugin.initialize(self.mock_plugin_manager)
        self.plugin.activate()
        result = self.plugin.deactivate()
        assert result is True

    @patch('requests.get')
    def test_fetch_data(self, mock_get):
        """æµ‹è¯•æ•°æ®è·å–"""
        # æ¨¡æ‹Ÿ HTTP å“åº”
        mock_response = Mock()
        mock_response.json.return_value = {'data': 'test'}
        mock_response.raise_for_status.return_value = None
        mock_get.return_value = mock_response

        # æµ‹è¯•æ•°æ®è·å–
        self.plugin.initialize(self.mock_plugin_manager)
        data = self.plugin.fetch_data()

        assert data == {'data': 'test'}
        mock_get.assert_called_once()
```

#### 2. é›†æˆæµ‹è¯•

```python
# tests/test_integration.py
import pytest
from PyQt6.QtWidgets import QApplication
from core.plugin_system import PluginManager
from main import MyPlugin

class TestPluginIntegration:
    """æ’ä»¶é›†æˆæµ‹è¯•"""

    @pytest.fixture(scope='class')
    def app(self):
        """åˆ›å»º QApplication"""
        app = QApplication.instance()
        if app is None:
            app = QApplication([])
        yield app
        app.quit()

    @pytest.fixture
    def plugin_manager(self, app):
        """åˆ›å»ºæ’ä»¶ç®¡ç†å™¨"""
        return PluginManager()

    def test_plugin_loading(self, plugin_manager):
        """æµ‹è¯•æ’ä»¶åŠ è½½"""
        # åˆ›å»ºæ’ä»¶å®ä¾‹
        plugin = MyPlugin()

        # åˆå§‹åŒ–æ’ä»¶
        result = plugin.initialize(plugin_manager)
        assert result is True

        # æ¿€æ´»æ’ä»¶
        result = plugin.activate()
        assert result is True

        # æ£€æŸ¥æ’ä»¶çŠ¶æ€
        assert plugin.status == PluginStatus.ENABLED

    def test_event_communication(self, plugin_manager):
        """æµ‹è¯•äº‹ä»¶é€šä¿¡"""
        plugin = MyPlugin()
        plugin.initialize(plugin_manager)
        plugin.activate()

        # è·å–äº‹ä»¶æ€»çº¿
        event_bus = plugin_manager.get_event_bus()

        # å‘é€æµ‹è¯•äº‹ä»¶
        from core.plugin_system import PluginEvent
        event = PluginEvent('test_event', {'test': 'data'})
        event_bus.publish(event)

        # éªŒè¯äº‹ä»¶å¤„ç†
        # è¿™é‡Œéœ€è¦æ ¹æ®å…·ä½“æ’ä»¶å®ç°æ¥éªŒè¯
```

### è°ƒè¯•æŠ€å·§

#### 1. æ—¥å¿—è°ƒè¯•

```python
import logging

class MyPlugin(IPlugin):
    def __init__(self):
        super().__init__()
        # è®¾ç½®è¯¦ç»†æ—¥å¿—
        self.logger.setLevel(logging.DEBUG)

        # æ·»åŠ æ–‡ä»¶å¤„ç†å™¨
        log_file = Path.home() / '.timenest' / 'logs' / 'my_plugin.log'
        log_file.parent.mkdir(parents=True, exist_ok=True)

        file_handler = logging.FileHandler(log_file)
        file_handler.setLevel(logging.DEBUG)

        formatter = logging.Formatter(
            '%(asctime)s - %(name)s - %(levelname)s - %(message)s'
        )
        file_handler.setFormatter(formatter)

        self.logger.addHandler(file_handler)

    def debug_method(self):
        """è°ƒè¯•æ–¹æ³•"""
        self.logger.debug("å¼€å§‹æ‰§è¡Œè°ƒè¯•æ–¹æ³•")

        try:
            # æ‰§è¡Œæ“ä½œ
            result = self.some_operation()
            self.logger.debug(f"æ“ä½œç»“æœ: {result}")

        except Exception as e:
            self.logger.exception("æ“ä½œå¤±è´¥")
            raise

        self.logger.debug("è°ƒè¯•æ–¹æ³•æ‰§è¡Œå®Œæˆ")
```

#### 2. æ€§èƒ½åˆ†æ

```python
import time
import functools

def performance_monitor(func):
    """æ€§èƒ½ç›‘æ§è£…é¥°å™¨"""
    @functools.wraps(func)
    def wrapper(self, *args, **kwargs):
        start_time = time.time()

        try:
            result = func(self, *args, **kwargs)
            return result

        finally:
            end_time = time.time()
            execution_time = end_time - start_time
            self.logger.info(f"{func.__name__} æ‰§è¡Œæ—¶é—´: {execution_time:.3f}s")

    return wrapper

class MyPlugin(IPlugin):
    @performance_monitor
    def expensive_operation(self):
        """è€—æ—¶æ“ä½œ"""
        # æ‰§è¡Œè€—æ—¶æ“ä½œ
        pass
```

#### 3. å†…å­˜ç›‘æ§

```python
import psutil
import gc

class MyPlugin(IPlugin):
    def monitor_memory(self):
        """ç›‘æ§å†…å­˜ä½¿ç”¨"""
        process = psutil.Process()
        memory_info = process.memory_info()

        self.logger.info(f"å†…å­˜ä½¿ç”¨: {memory_info.rss / 1024 / 1024:.2f} MB")
        self.logger.info(f"è™šæ‹Ÿå†…å­˜: {memory_info.vms / 1024 / 1024:.2f} MB")

        # åƒåœ¾å›æ”¶ç»Ÿè®¡
        gc_stats = gc.get_stats()
        self.logger.info(f"åƒåœ¾å›æ”¶ç»Ÿè®¡: {gc_stats}")
```

## ğŸ“¦ æ‰“åŒ…å’Œå‘å¸ƒ

### æ’ä»¶æ¸…å•æ–‡ä»¶

æ¯ä¸ªæ’ä»¶éƒ½éœ€è¦ä¸€ä¸ª `plugin.json` æ¸…å•æ–‡ä»¶ï¼š

```json
{
  "id": "my_weather_plugin",
  "name": "å¤©æ°”æ’ä»¶",
  "version": "1.0.0",
  "description": "æ˜¾ç¤ºå®æ—¶å¤©æ°”ä¿¡æ¯çš„æ’ä»¶",
  "author": "Your Name",
  "email": "your.email@example.com",
  "homepage": "https://github.com/yourname/my-weather-plugin",
  "repository": "https://github.com/yourname/my-weather-plugin.git",
  "license": "MIT",
  "plugin_type": "component",
  "main_module": "main.py",
  "plugin_class": "WeatherPlugin",
  "api_version": "1.0.0",
  "min_app_version": "1.0.0",
  "max_app_version": "2.0.0",
  "dependencies": [],
  "python_dependencies": [
    "requests>=2.25.0",
    "Pillow>=8.0.0"
  ],
  "permissions": [
    "network_access",
    "file_read",
    "notification_send"
  ],
  "tags": ["weather", "widget", "utility"],
  "screenshots": [
    "screenshots/main.png",
    "screenshots/settings.png"
  ],
  "changelog": "CHANGELOG.md",
  "settings_schema": {
    "type": "object",
    "properties": {
      "api_key": {
        "type": "string",
        "title": "API å¯†é’¥",
        "description": "å¤©æ°”æœåŠ¡ API å¯†é’¥"
      },
      "refresh_interval": {
        "type": "integer",
        "title": "åˆ·æ–°é—´éš”",
        "description": "æ•°æ®åˆ·æ–°é—´éš”ï¼ˆç§’ï¼‰",
        "minimum": 60,
        "maximum": 3600,
        "default": 300
      }
    },
    "required": ["api_key"]
  }
}
```

### ç›®å½•ç»“æ„

æ ‡å‡†æ’ä»¶ç›®å½•ç»“æ„ï¼š

```
my_weather_plugin/
â”œâ”€â”€ plugin.json              # æ’ä»¶æ¸…å•æ–‡ä»¶
â”œâ”€â”€ main.py                   # ä¸»æ¨¡å—æ–‡ä»¶
â”œâ”€â”€ README.md                 # æ’ä»¶è¯´æ˜
â”œâ”€â”€ CHANGELOG.md              # æ›´æ–°æ—¥å¿—
â”œâ”€â”€ LICENSE                   # è®¸å¯è¯æ–‡ä»¶
â”œâ”€â”€ requirements.txt          # Python ä¾èµ–
â”œâ”€â”€ assets/                   # èµ„æºæ–‡ä»¶
â”‚   â”œâ”€â”€ icons/               # å›¾æ ‡æ–‡ä»¶
â”‚   â”œâ”€â”€ images/              # å›¾ç‰‡æ–‡ä»¶
â”‚   â””â”€â”€ sounds/              # éŸ³é¢‘æ–‡ä»¶
â”œâ”€â”€ ui/                      # UI æ–‡ä»¶
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ main_widget.py       # ä¸»ç•Œé¢
â”‚   â””â”€â”€ settings_dialog.py   # è®¾ç½®å¯¹è¯æ¡†
â”œâ”€â”€ utils/                   # å·¥å…·æ¨¡å—
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ api_client.py        # API å®¢æˆ·ç«¯
â”‚   â””â”€â”€ data_parser.py       # æ•°æ®è§£æ
â”œâ”€â”€ tests/                   # æµ‹è¯•æ–‡ä»¶
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ test_main.py
â”‚   â””â”€â”€ test_utils.py
â”œâ”€â”€ docs/                    # æ–‡æ¡£
â”‚   â”œâ”€â”€ user_guide.md
â”‚   â””â”€â”€ api_reference.md
â””â”€â”€ screenshots/             # æˆªå›¾
    â”œâ”€â”€ main.png
    â””â”€â”€ settings.png
```

### æ‰“åŒ…è„šæœ¬

åˆ›å»º `build.py` æ‰“åŒ…è„šæœ¬ï¼š

```python
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
æ’ä»¶æ‰“åŒ…è„šæœ¬
"""

import os
import json
import zipfile
import shutil
from pathlib import Path

def build_plugin():
    """æ„å»ºæ’ä»¶åŒ…"""
    # è¯»å–æ’ä»¶ä¿¡æ¯
    with open('plugin.json', 'r', encoding='utf-8') as f:
        plugin_info = json.load(f)

    plugin_id = plugin_info['id']
    version = plugin_info['version']

    # åˆ›å»ºæ„å»ºç›®å½•
    build_dir = Path('build')
    build_dir.mkdir(exist_ok=True)

    # åˆ›å»ºæ’ä»¶åŒ…
    package_name = f"{plugin_id}-{version}.zip"
    package_path = build_dir / package_name

    # è¦åŒ…å«çš„æ–‡ä»¶å’Œç›®å½•
    include_patterns = [
        'plugin.json',
        'main.py',
        'README.md',
        'LICENSE',
        'requirements.txt',
        'assets/',
        'ui/',
        'utils/',
        'docs/',
        'screenshots/'
    ]

    # è¦æ’é™¤çš„æ–‡ä»¶å’Œç›®å½•
    exclude_patterns = [
        '__pycache__/',
        '*.pyc',
        '.git/',
        '.gitignore',
        'build/',
        'tests/',
        '.pytest_cache/',
        '*.log'
    ]

    with zipfile.ZipFile(package_path, 'w', zipfile.ZIP_DEFLATED) as zipf:
        for pattern in include_patterns:
            path = Path(pattern)

            if path.is_file():
                zipf.write(path, path)
                print(f"æ·»åŠ æ–‡ä»¶: {path}")

            elif path.is_dir():
                for file_path in path.rglob('*'):
                    if file_path.is_file():
                        # æ£€æŸ¥æ˜¯å¦åº”è¯¥æ’é™¤
                        should_exclude = False
                        for exclude_pattern in exclude_patterns:
                            if exclude_pattern in str(file_path):
                                should_exclude = True
                                break

                        if not should_exclude:
                            zipf.write(file_path, file_path)
                            print(f"æ·»åŠ æ–‡ä»¶: {file_path}")

    print(f"\næ’ä»¶åŒ…æ„å»ºå®Œæˆ: {package_path}")
    print(f"åŒ…å¤§å°: {package_path.stat().st_size / 1024:.2f} KB")

    return package_path

def validate_plugin():
    """éªŒè¯æ’ä»¶åŒ…"""
    print("éªŒè¯æ’ä»¶...")

    # æ£€æŸ¥å¿…éœ€æ–‡ä»¶
    required_files = ['plugin.json', 'main.py']
    for file_name in required_files:
        if not Path(file_name).exists():
            print(f"é”™è¯¯: ç¼ºå°‘å¿…éœ€æ–‡ä»¶ {file_name}")
            return False

    # éªŒè¯æ’ä»¶æ¸…å•
    try:
        with open('plugin.json', 'r', encoding='utf-8') as f:
            plugin_info = json.load(f)

        required_fields = ['id', 'name', 'version', 'main_module', 'plugin_class']
        for field in required_fields:
            if field not in plugin_info:
                print(f"é”™è¯¯: plugin.json ç¼ºå°‘å¿…éœ€å­—æ®µ {field}")
                return False

    except json.JSONDecodeError as e:
        print(f"é”™è¯¯: plugin.json æ ¼å¼æ— æ•ˆ: {e}")
        return False

    print("æ’ä»¶éªŒè¯é€šè¿‡")
    return True

if __name__ == '__main__':
    if validate_plugin():
        build_plugin()
    else:
        print("æ’ä»¶éªŒè¯å¤±è´¥ï¼Œæ„å»ºä¸­æ­¢")
```

### å‘å¸ƒæµç¨‹

#### 1. å‡†å¤‡å‘å¸ƒ

```bash
# 1. æ›´æ–°ç‰ˆæœ¬å·
# ç¼–è¾‘ plugin.json ä¸­çš„ version å­—æ®µ

# 2. æ›´æ–°æ›´æ–°æ—¥å¿—
# ç¼–è¾‘ CHANGELOG.md

# 3. è¿è¡Œæµ‹è¯•
python -m pytest tests/

# 4. æ„å»ºæ’ä»¶åŒ…
python build.py

# 5. æµ‹è¯•æ’ä»¶åŒ…
# åœ¨ TimeNest ä¸­å®‰è£…å’Œæµ‹è¯•æ’ä»¶åŒ…
```

#### 2. å‘å¸ƒåˆ°å•†åŸ

```bash
# 1. åˆ›å»ºå‘å¸ƒåˆ†æ”¯
git checkout -b release/v1.0.0

# 2. æäº¤æ›´æ”¹
git add .
git commit -m "Release v1.0.0"

# 3. åˆ›å»ºæ ‡ç­¾
git tag v1.0.0

# 4. æ¨é€åˆ°ä»“åº“
git push origin release/v1.0.0
git push origin v1.0.0

# 5. åˆ›å»º GitHub Release
# åœ¨ GitHub ä¸Šåˆ›å»º Releaseï¼Œä¸Šä¼ æ’ä»¶åŒ…
```

#### 3. æäº¤åˆ° TimeNest Store

1. **Fork TimeNest Store ä»“åº“**
   ```bash
   git clone https://github.com/ziyi127/TimeNest-Store.git
   cd TimeNest-Store
   ```

2. **æ·»åŠ æ’ä»¶ä¿¡æ¯**
   ç¼–è¾‘ `plugins.json` æ–‡ä»¶ï¼Œæ·»åŠ æ‚¨çš„æ’ä»¶ä¿¡æ¯ï¼š
   ```json
   {
     "plugins": [
       {
         "id": "my_weather_plugin",
         "name": "å¤©æ°”æ’ä»¶",
         "version": "1.0.0",
         "description": "æ˜¾ç¤ºå®æ—¶å¤©æ°”ä¿¡æ¯çš„æ’ä»¶",
         "author": "Your Name",
         "category": "ç»„ä»¶",
         "download_url": "https://github.com/yourname/my-weather-plugin/releases/download/v1.0.0/my_weather_plugin-1.0.0.zip",
         "homepage": "https://github.com/yourname/my-weather-plugin",
         "repository": "https://github.com/yourname/my-weather-plugin",
         "license": "MIT",
         "tags": ["weather", "widget"],
         "downloads": 0,
         "rating": 0.0,
         "size": 15360,
         "checksum": "sha256:abcdef...",
         "dependencies": [],
         "min_app_version": "1.0.0",
         "screenshots": [
           "https://github.com/yourname/my-weather-plugin/raw/main/screenshots/main.png"
         ],
         "created_at": "2024-01-01T00:00:00Z",
         "updated_at": "2024-01-01T00:00:00Z"
       }
     ]
   }
   ```

3. **æäº¤ Pull Request**
   ```bash
   git add plugins.json
   git commit -m "Add my_weather_plugin v1.0.0"
   git push origin main
   # åœ¨ GitHub ä¸Šåˆ›å»º Pull Request
   ```

## ğŸ“š ç¤ºä¾‹æ’ä»¶

### ç®€å•çš„æ—¶é’Ÿæ’ä»¶

```python
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
ç®€å•æ—¶é’Ÿæ’ä»¶ç¤ºä¾‹
"""

import time
from datetime import datetime
from PyQt6.QtWidgets import QWidget, QLabel, QVBoxLayout
from PyQt6.QtCore import QTimer, Qt
from PyQt6.QtGui import QFont

from core.plugin_system import IPlugin, PluginMetadata, PluginType, PluginStatus

class ClockWidget(QWidget):
    """æ—¶é’Ÿç»„ä»¶"""

    def __init__(self):
        super().__init__()
        self.setup_ui()
        self.setup_timer()

    def setup_ui(self):
        """è®¾ç½®ç•Œé¢"""
        self.setWindowTitle("æ—¶é’Ÿ")
        self.setFixedSize(200, 100)

        layout = QVBoxLayout()

        # æ—¶é—´æ ‡ç­¾
        self.time_label = QLabel()
        self.time_label.setAlignment(Qt.AlignmentFlag.AlignCenter)
        self.time_label.setFont(QFont("Arial", 16, QFont.Weight.Bold))
        layout.addWidget(self.time_label)

        # æ—¥æœŸæ ‡ç­¾
        self.date_label = QLabel()
        self.date_label.setAlignment(Qt.AlignmentFlag.AlignCenter)
        self.date_label.setFont(QFont("Arial", 10))
        layout.addWidget(self.date_label)

        self.setLayout(layout)
        self.update_time()

    def setup_timer(self):
        """è®¾ç½®å®šæ—¶å™¨"""
        self.timer = QTimer()
        self.timer.timeout.connect(self.update_time)
        self.timer.start(1000)  # æ¯ç§’æ›´æ–°

    def update_time(self):
        """æ›´æ–°æ—¶é—´æ˜¾ç¤º"""
        now = datetime.now()
        time_str = now.strftime("%H:%M:%S")
        date_str = now.strftime("%Y-%m-%d")

        self.time_label.setText(time_str)
        self.date_label.setText(date_str)

    def cleanup(self):
        """æ¸…ç†èµ„æº"""
        if hasattr(self, 'timer'):
            self.timer.stop()

class ClockPlugin(IPlugin):
    """æ—¶é’Ÿæ’ä»¶"""

    def __init__(self):
        super().__init__()
        self.metadata = PluginMetadata(
            id="simple_clock",
            name="ç®€å•æ—¶é’Ÿ",
            version="1.0.0",
            description="æ˜¾ç¤ºå½“å‰æ—¶é—´å’Œæ—¥æœŸçš„ç®€å•æ—¶é’Ÿç»„ä»¶",
            author="TimeNest Team",
            plugin_type=PluginType.COMPONENT
        )
        self.widget = None

    def initialize(self, plugin_manager) -> bool:
        """åˆå§‹åŒ–æ’ä»¶"""
        try:
            self.plugin_manager = plugin_manager
            self.logger.info("æ—¶é’Ÿæ’ä»¶åˆå§‹åŒ–å®Œæˆ")
            return True

        except Exception as e:
            self.logger.error(f"æ—¶é’Ÿæ’ä»¶åˆå§‹åŒ–å¤±è´¥: {e}")
            return False

    def activate(self) -> bool:
        """æ¿€æ´»æ’ä»¶"""
        try:
            # åˆ›å»ºæ—¶é’Ÿç»„ä»¶
            self.widget = ClockWidget()

            # æ³¨å†Œåˆ°æµ®çª—ç®¡ç†å™¨
            floating_manager = self.plugin_manager.get_floating_manager()
            if floating_manager:
                floating_manager.add_component('simple_clock', self.widget)

            # æ˜¾ç¤ºç»„ä»¶
            self.widget.show()

            self.logger.info("æ—¶é’Ÿæ’ä»¶å·²æ¿€æ´»")
            return True

        except Exception as e:
            self.logger.error(f"æ—¶é’Ÿæ’ä»¶æ¿€æ´»å¤±è´¥: {e}")
            return False

    def deactivate(self) -> bool:
        """åœç”¨æ’ä»¶"""
        try:
            if self.widget:
                # ä»æµ®çª—ç®¡ç†å™¨ç§»é™¤
                floating_manager = self.plugin_manager.get_floating_manager()
                if floating_manager:
                    floating_manager.remove_component('simple_clock')

                # éšè—ç»„ä»¶
                self.widget.hide()

            self.logger.info("æ—¶é’Ÿæ’ä»¶å·²åœç”¨")
            return True

        except Exception as e:
            self.logger.error(f"æ—¶é’Ÿæ’ä»¶åœç”¨å¤±è´¥: {e}")
            return False

    def cleanup(self) -> bool:
        """æ¸…ç†æ’ä»¶èµ„æº"""
        try:
            if self.widget:
                self.widget.cleanup()
                self.widget.deleteLater()
                self.widget = None

            self.logger.info("æ—¶é’Ÿæ’ä»¶èµ„æºå·²æ¸…ç†")
            return True

        except Exception as e:
            self.logger.error(f"æ—¶é’Ÿæ’ä»¶æ¸…ç†å¤±è´¥: {e}")
            return False

# æ’ä»¶å…¥å£ç‚¹
def create_plugin():
    """åˆ›å»ºæ’ä»¶å®ä¾‹"""
    return ClockPlugin()
```

### å¤©æ°”æ’ä»¶ç¤ºä¾‹

```python
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
å¤©æ°”æ’ä»¶ç¤ºä¾‹
"""

import requests
import json
from datetime import datetime
from PyQt6.QtWidgets import (QWidget, QLabel, QVBoxLayout, QHBoxLayout,
                            QPushButton, QLineEdit, QMessageBox)
from PyQt6.QtCore import QTimer, Qt, QThread, pyqtSignal
from PyQt6.QtGui import QFont, QPixmap

from core.plugin_system import IPlugin, PluginMetadata, PluginType

class WeatherWorker(QThread):
    """å¤©æ°”æ•°æ®è·å–å·¥ä½œçº¿ç¨‹"""

    data_ready = pyqtSignal(dict)
    error_occurred = pyqtSignal(str)

    def __init__(self, api_key, city):
        super().__init__()
        self.api_key = api_key
        self.city = city

    def run(self):
        """è·å–å¤©æ°”æ•°æ®"""
        try:
            # è¿™é‡Œä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®ï¼Œå®é™…åº”è¯¥è°ƒç”¨çœŸå®çš„å¤©æ°” API
            url = f"https://api.openweathermap.org/data/2.5/weather"
            params = {
                'q': self.city,
                'appid': self.api_key,
                'units': 'metric',
                'lang': 'zh_cn'
            }

            response = requests.get(url, params=params, timeout=10)
            response.raise_for_status()

            data = response.json()
            self.data_ready.emit(data)

        except Exception as e:
            self.error_occurred.emit(str(e))

class WeatherWidget(QWidget):
    """å¤©æ°”ç»„ä»¶"""

    def __init__(self, plugin):
        super().__init__()
        self.plugin = plugin
        self.worker = None
        self.setup_ui()
        self.setup_timer()

    def setup_ui(self):
        """è®¾ç½®ç•Œé¢"""
        self.setWindowTitle("å¤©æ°”")
        self.setFixedSize(250, 150)

        layout = QVBoxLayout()

        # åŸå¸‚è¾“å…¥
        city_layout = QHBoxLayout()
        self.city_input = QLineEdit()
        self.city_input.setPlaceholderText("è¾“å…¥åŸå¸‚åç§°")
        self.city_input.setText(self.plugin.get_setting('city', 'åŒ—äº¬'))

        self.refresh_button = QPushButton("åˆ·æ–°")
        self.refresh_button.clicked.connect(self.refresh_weather)

        city_layout.addWidget(self.city_input)
        city_layout.addWidget(self.refresh_button)
        layout.addLayout(city_layout)

        # å¤©æ°”ä¿¡æ¯
        self.weather_label = QLabel("æ­£åœ¨åŠ è½½å¤©æ°”ä¿¡æ¯...")
        self.weather_label.setAlignment(Qt.AlignmentFlag.AlignCenter)
        self.weather_label.setFont(QFont("Arial", 12))
        layout.addWidget(self.weather_label)

        # æ¸©åº¦ä¿¡æ¯
        self.temp_label = QLabel("")
        self.temp_label.setAlignment(Qt.AlignmentFlag.AlignCenter)
        self.temp_label.setFont(QFont("Arial", 16, QFont.Weight.Bold))
        layout.addWidget(self.temp_label)

        # æ›´æ–°æ—¶é—´
        self.update_label = QLabel("")
        self.update_label.setAlignment(Qt.AlignmentFlag.AlignCenter)
        self.update_label.setFont(QFont("Arial", 8))
        layout.addWidget(self.update_label)

        self.setLayout(layout)

    def setup_timer(self):
        """è®¾ç½®å®šæ—¶å™¨"""
        self.timer = QTimer()
        self.timer.timeout.connect(self.refresh_weather)

        # ä»é…ç½®è·å–åˆ·æ–°é—´éš”
        interval = self.plugin.get_setting('refresh_interval', 300) * 1000
        self.timer.start(interval)

    def refresh_weather(self):
        """åˆ·æ–°å¤©æ°”æ•°æ®"""
        city = self.city_input.text().strip()
        if not city:
            return

        # ä¿å­˜åŸå¸‚è®¾ç½®
        self.plugin.set_setting('city', city)

        # è·å– API å¯†é’¥
        api_key = self.plugin.get_setting('api_key', '')
        if not api_key:
            self.weather_label.setText("è¯·é…ç½® API å¯†é’¥")
            return

        # å¯åŠ¨å·¥ä½œçº¿ç¨‹
        if self.worker and self.worker.isRunning():
            return

        self.weather_label.setText("æ­£åœ¨æ›´æ–°...")
        self.worker = WeatherWorker(api_key, city)
        self.worker.data_ready.connect(self.on_weather_data)
        self.worker.error_occurred.connect(self.on_weather_error)
        self.worker.start()

    def on_weather_data(self, data):
        """å¤„ç†å¤©æ°”æ•°æ®"""
        try:
            weather = data['weather'][0]
            main = data['main']

            description = weather['description']
            temp = main['temp']
            feels_like = main['feels_like']

            self.weather_label.setText(description)
            self.temp_label.setText(f"{temp:.1f}Â°C")

            now = datetime.now().strftime("%H:%M")
            self.update_label.setText(f"æ›´æ–°æ—¶é—´: {now}")

        except Exception as e:
            self.plugin.logger.error(f"è§£æå¤©æ°”æ•°æ®å¤±è´¥: {e}")
            self.weather_label.setText("æ•°æ®è§£æå¤±è´¥")

    def on_weather_error(self, error):
        """å¤„ç†å¤©æ°”æ•°æ®é”™è¯¯"""
        self.plugin.logger.error(f"è·å–å¤©æ°”æ•°æ®å¤±è´¥: {error}")
        self.weather_label.setText("è·å–æ•°æ®å¤±è´¥")

    def cleanup(self):
        """æ¸…ç†èµ„æº"""
        if hasattr(self, 'timer'):
            self.timer.stop()

        if self.worker and self.worker.isRunning():
            self.worker.quit()
            self.worker.wait()

class WeatherPlugin(IPlugin):
    """å¤©æ°”æ’ä»¶"""

    def __init__(self):
        super().__init__()
        self.metadata = PluginMetadata(
            id="weather_widget",
            name="å¤©æ°”ç»„ä»¶",
            version="1.0.0",
            description="æ˜¾ç¤ºå®æ—¶å¤©æ°”ä¿¡æ¯çš„ç»„ä»¶",
            author="TimeNest Team",
            plugin_type=PluginType.COMPONENT
        )
        self.widget = None

    def initialize(self, plugin_manager) -> bool:
        """åˆå§‹åŒ–æ’ä»¶"""
        try:
            self.plugin_manager = plugin_manager
            self.load_config()
            self.logger.info("å¤©æ°”æ’ä»¶åˆå§‹åŒ–å®Œæˆ")
            return True

        except Exception as e:
            self.logger.error(f"å¤©æ°”æ’ä»¶åˆå§‹åŒ–å¤±è´¥: {e}")
            return False

    def activate(self) -> bool:
        """æ¿€æ´»æ’ä»¶"""
        try:
            # åˆ›å»ºå¤©æ°”ç»„ä»¶
            self.widget = WeatherWidget(self)

            # æ³¨å†Œåˆ°æµ®çª—ç®¡ç†å™¨
            floating_manager = self.plugin_manager.get_floating_manager()
            if floating_manager:
                floating_manager.add_component('weather_widget', self.widget)

            # æ˜¾ç¤ºç»„ä»¶
            self.widget.show()

            self.logger.info("å¤©æ°”æ’ä»¶å·²æ¿€æ´»")
            return True

        except Exception as e:
            self.logger.error(f"å¤©æ°”æ’ä»¶æ¿€æ´»å¤±è´¥: {e}")
            return False

    def deactivate(self) -> bool:
        """åœç”¨æ’ä»¶"""
        try:
            if self.widget:
                # ä»æµ®çª—ç®¡ç†å™¨ç§»é™¤
                floating_manager = self.plugin_manager.get_floating_manager()
                if floating_manager:
                    floating_manager.remove_component('weather_widget')

                # éšè—ç»„ä»¶
                self.widget.hide()

            self.logger.info("å¤©æ°”æ’ä»¶å·²åœç”¨")
            return True

        except Exception as e:
            self.logger.error(f"å¤©æ°”æ’ä»¶åœç”¨å¤±è´¥: {e}")
            return False

    def cleanup(self) -> bool:
        """æ¸…ç†æ’ä»¶èµ„æº"""
        try:
            if self.widget:
                self.widget.cleanup()
                self.widget.deleteLater()
                self.widget = None

            self.logger.info("å¤©æ°”æ’ä»¶èµ„æºå·²æ¸…ç†")
            return True

        except Exception as e:
            self.logger.error(f"å¤©æ°”æ’ä»¶æ¸…ç†å¤±è´¥: {e}")
            return False

    def load_config(self):
        """åŠ è½½é…ç½®"""
        self.config = self.plugin_manager.get_plugin_config(self.metadata.id)

        # è®¾ç½®é»˜è®¤é…ç½®
        defaults = {
            'api_key': '',
            'city': 'åŒ—äº¬',
            'refresh_interval': 300,  # 5åˆ†é’Ÿ
            'show_notifications': True
        }

        for key, value in defaults.items():
            if key not in self.config:
                self.config[key] = value

    def save_config(self):
        """ä¿å­˜é…ç½®"""
        self.plugin_manager.set_plugin_config(self.metadata.id, self.config)

    def get_setting(self, key: str, default=None):
        """è·å–è®¾ç½®"""
        return self.config.get(key, default)

    def set_setting(self, key: str, value):
        """è®¾ç½®é…ç½®"""
        self.config[key] = value
        self.save_config()

# æ’ä»¶å…¥å£ç‚¹
def create_plugin():
    """åˆ›å»ºæ’ä»¶å®ä¾‹"""
    return WeatherPlugin()
```

## â“ å¸¸è§é—®é¢˜

### Q1: æ’ä»¶åŠ è½½å¤±è´¥æ€ä¹ˆåŠï¼Ÿ

**A**: æ£€æŸ¥ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

1. **æ’ä»¶æ¸…å•æ–‡ä»¶**ï¼šç¡®ä¿ `plugin.json` æ ¼å¼æ­£ç¡®ï¼ŒåŒ…å«æ‰€æœ‰å¿…éœ€å­—æ®µ
2. **ä¸»æ¨¡å—æ–‡ä»¶**ï¼šç¡®ä¿ä¸»æ¨¡å—æ–‡ä»¶å­˜åœ¨ä¸”å¯ä»¥æ­£å¸¸å¯¼å…¥
3. **æ’ä»¶ç±»**ï¼šç¡®ä¿æ’ä»¶ç±»ç»§æ‰¿äº† `IPlugin` æ¥å£
4. **ä¾èµ–å…³ç³»**ï¼šæ£€æŸ¥æ’ä»¶ä¾èµ–æ˜¯å¦å·²å®‰è£…
5. **æƒé™é—®é¢˜**ï¼šç¡®ä¿æ’ä»¶ç›®å½•æœ‰æ­£ç¡®çš„è¯»å†™æƒé™

```bash
# æŸ¥çœ‹æ’ä»¶åŠ è½½æ—¥å¿—
tail -f ~/.timenest/logs/plugin_manager.log
```

### Q2: å¦‚ä½•è°ƒè¯•æ’ä»¶ï¼Ÿ

**A**: ä½¿ç”¨ä»¥ä¸‹è°ƒè¯•æ–¹æ³•ï¼š

1. **æ—¥å¿—è°ƒè¯•**ï¼šåœ¨æ’ä»¶ä¸­æ·»åŠ è¯¦ç»†çš„æ—¥å¿—è¾“å‡º
2. **æ–­ç‚¹è°ƒè¯•**ï¼šä½¿ç”¨ IDE çš„è°ƒè¯•åŠŸèƒ½
3. **å•å…ƒæµ‹è¯•**ï¼šç¼–å†™æµ‹è¯•ç”¨ä¾‹éªŒè¯æ’ä»¶åŠŸèƒ½
4. **æ’ä»¶å¼€å‘æ¨¡å¼**ï¼šåœ¨ TimeNest ä¸­å¯ç”¨æ’ä»¶å¼€å‘æ¨¡å¼

```python
# å¯ç”¨è¯¦ç»†æ—¥å¿—
self.logger.setLevel(logging.DEBUG)

# æ·»åŠ è°ƒè¯•ä¿¡æ¯
self.logger.debug(f"å˜é‡å€¼: {variable}")
```

### Q3: æ’ä»¶å¦‚ä½•ä¸ä¸»ç¨‹åºé€šä¿¡ï¼Ÿ

**A**: ä½¿ç”¨äº‹ä»¶ç³»ç»Ÿè¿›è¡Œé€šä¿¡ï¼š

```python
# è®¢é˜…ç³»ç»Ÿäº‹ä»¶
event_bus = self.plugin_manager.get_event_bus()
event_bus.subscribe('schedule_changed', self.on_schedule_changed)

# å‘å¸ƒè‡ªå®šä¹‰äº‹ä»¶
event = PluginEvent('my_event', {'data': 'value'})
event_bus.publish(event)
```

### Q4: å¦‚ä½•å¤„ç†æ’ä»¶ä¾èµ–ï¼Ÿ

**A**: åœ¨æ’ä»¶æ¸…å•ä¸­å£°æ˜ä¾èµ–ï¼š

```json
{
  "dependencies": ["other_plugin_id"],
  "python_dependencies": ["requests>=2.25.0"]
}
```

æ’ä»¶ç®¡ç†å™¨ä¼šè‡ªåŠ¨å¤„ç†ä¾èµ–å…³ç³»å’ŒåŠ è½½é¡ºåºã€‚

### Q5: æ’ä»¶å¦‚ä½•æŒä¹…åŒ–æ•°æ®ï¼Ÿ

**A**: ä½¿ç”¨æ’ä»¶é…ç½®ç³»ç»Ÿæˆ–æœ¬åœ°æ–‡ä»¶ï¼š

```python
# ä½¿ç”¨é…ç½®ç³»ç»Ÿ
self.plugin_manager.set_plugin_config(self.metadata.id, data)

# ä½¿ç”¨æœ¬åœ°æ–‡ä»¶
data_file = Path.home() / '.timenest' / 'plugins' / self.metadata.id / 'data.json'
with open(data_file, 'w') as f:
    json.dump(data, f)
```

### Q6: å¦‚ä½•åˆ›å»ºæ’ä»¶è®¾ç½®ç•Œé¢ï¼Ÿ

**A**: åˆ›å»ºè®¾ç½®å¯¹è¯æ¡†ï¼š

```python
from PyQt6.QtWidgets import QDialog, QFormLayout, QLineEdit, QPushButton

class SettingsDialog(QDialog):
    def __init__(self, plugin):
        super().__init__()
        self.plugin = plugin
        self.setup_ui()

    def setup_ui(self):
        layout = QFormLayout()

        self.api_key_input = QLineEdit()
        self.api_key_input.setText(self.plugin.get_setting('api_key', ''))
        layout.addRow("API å¯†é’¥:", self.api_key_input)

        save_button = QPushButton("ä¿å­˜")
        save_button.clicked.connect(self.save_settings)
        layout.addWidget(save_button)

        self.setLayout(layout)

    def save_settings(self):
        self.plugin.set_setting('api_key', self.api_key_input.text())
        self.accept()
```

### Q7: æ’ä»¶å¦‚ä½•å¤„ç†é”™è¯¯ï¼Ÿ

**A**: ä½¿ç”¨å¼‚å¸¸å¤„ç†å’Œæ—¥å¿—è®°å½•ï¼š

```python
def risky_operation(self):
    try:
        # æ‰§è¡Œå¯èƒ½å¤±è´¥çš„æ“ä½œ
        result = self.api_call()
        return result

    except requests.exceptions.Timeout:
        self.logger.error("API è°ƒç”¨è¶…æ—¶")
        return None

    except Exception as e:
        self.logger.exception("æœªçŸ¥é”™è¯¯")
        return None
```

### Q8: å¦‚ä½•ä¼˜åŒ–æ’ä»¶æ€§èƒ½ï¼Ÿ

**A**: ä½¿ç”¨ä»¥ä¸‹ä¼˜åŒ–æŠ€å·§ï¼š

1. **å¼‚æ­¥æ“ä½œ**ï¼šä½¿ç”¨ QThread å¤„ç†è€—æ—¶æ“ä½œ
2. **ç¼“å­˜æœºåˆ¶**ï¼šç¼“å­˜é¢‘ç¹è®¿é—®çš„æ•°æ®
3. **å»¶è¿ŸåŠ è½½**ï¼šæŒ‰éœ€åŠ è½½èµ„æº
4. **èµ„æºæ¸…ç†**ï¼šåŠæ—¶é‡Šæ”¾ä¸éœ€è¦çš„èµ„æº

```python
# ä½¿ç”¨ç¼“å­˜
@lru_cache(maxsize=128)
def expensive_calculation(self, param):
    # è€—æ—¶è®¡ç®—
    pass

# å¼‚æ­¥æ“ä½œ
def start_background_task(self):
    self.worker = BackgroundWorker()
    self.worker.finished.connect(self.on_task_finished)
    self.worker.start()
```

---

## ğŸ‰ æ€»ç»“

æ­å–œæ‚¨å®Œæˆäº† TimeNest æ’ä»¶å¼€å‘æŒ‡å—çš„å­¦ä¹ ï¼ç°åœ¨æ‚¨åº”è¯¥èƒ½å¤Ÿï¼š

- âœ… ç†è§£ TimeNest æ’ä»¶ç³»ç»Ÿæ¶æ„
- âœ… æ­å»ºæ’ä»¶å¼€å‘ç¯å¢ƒ
- âœ… ä½¿ç”¨æ’ä»¶ API æ¥å£
- âœ… ç®¡ç†æ’ä»¶ç”Ÿå‘½å‘¨æœŸ
- âœ… å®ç°æ’ä»¶é€šä¿¡æœºåˆ¶
- âœ… éµå¾ªå¼€å‘æœ€ä½³å®è·µ
- âœ… æµ‹è¯•å’Œè°ƒè¯•æ’ä»¶
- âœ… æ‰“åŒ…å’Œå‘å¸ƒæ’ä»¶

### ä¸‹ä¸€æ­¥

1. **å®è·µé¡¹ç›®**ï¼šå°è¯•åˆ›å»ºä¸€ä¸ªç®€å•çš„æ’ä»¶
2. **ç¤¾åŒºå‚ä¸**ï¼šåŠ å…¥ TimeNest å¼€å‘è€…ç¤¾åŒº
3. **è´¡çŒ®ä»£ç **ï¼šä¸º TimeNest é¡¹ç›®è´¡çŒ®æ’ä»¶
4. **åˆ†äº«ç»éªŒ**ï¼šä¸å…¶ä»–å¼€å‘è€…åˆ†äº«æ‚¨çš„æ’ä»¶å¼€å‘ç»éªŒ

### è·å–å¸®åŠ©

- ğŸ“– [å®˜æ–¹æ–‡æ¡£](https://ziyi127.github.io/TimeNest-Website)
- ğŸ’¬ [GitHub Discussions](https://github.com/ziyi127/TimeNest/discussions)
- ğŸ“§ [é‚®ä»¶æ”¯æŒ](mailto:ziyihed@outlook.com)
- ğŸ› [é—®é¢˜åé¦ˆ](https://github.com/ziyi127/TimeNest/issues)

ç¥æ‚¨æ’ä»¶å¼€å‘æ„‰å¿«ï¼ğŸš€
```
```
