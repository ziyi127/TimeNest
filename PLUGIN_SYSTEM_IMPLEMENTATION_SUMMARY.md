# TimeNest æ’ä»¶ç³»ç»Ÿå®ç°æ€»ç»“

æœ¬æ–‡æ¡£æ€»ç»“äº†ä¸º TimeNest é¡¹ç›®å®Œæˆçš„æ’ä»¶å•†åŸé…ç½®å’Œæ’ä»¶å¼€å‘æŒ‡å—åˆ›å»ºå·¥ä½œã€‚

## ğŸ“‹ ä»»åŠ¡å®Œæˆæ¦‚è§ˆ

### âœ… ä»»åŠ¡1ï¼šé…ç½®æ’ä»¶å•†åŸåœ°å€

å·²æˆåŠŸé…ç½®æ’ä»¶å•†åŸç³»ç»Ÿï¼ŒåŒ…æ‹¬ï¼š

1. **æ’ä»¶å•†åŸç®¡ç†å™¨** (`core/plugin_marketplace.py`)
2. **é…ç½®ç®¡ç†é›†æˆ** (æ›´æ–° `core/config_manager.py`)
3. **æ’ä»¶ç®¡ç†å™¨é›†æˆ** (æ›´æ–° `core/plugin_system.py`)
4. **åº”ç”¨ç®¡ç†å™¨é›†æˆ** (æ›´æ–° `core/app_manager.py`)

### âœ… ä»»åŠ¡2ï¼šåˆ›å»ºæ’ä»¶å¼€å‘æŒ‡å—

å·²åˆ›å»ºå®Œæ•´çš„æ’ä»¶å¼€å‘æ–‡æ¡£ä½“ç³»ï¼ŒåŒ…æ‹¬ï¼š

1. **æ’ä»¶å¼€å‘æŒ‡å—** (`PLUGIN_DEVELOPMENT_GUIDE.md`)
2. **æ’ä»¶æ¨¡æ¿** (`plugin_template/`)
3. **ç¤ºä¾‹é…ç½®** (`plugin_store_example.json`)

---

## ğŸ”§ ä»»åŠ¡1è¯¦ç»†å®ç°

### æ’ä»¶å•†åŸåœ°å€é…ç½®

**å•†åŸåœ°å€è®¾ç½®ï¼š**
```
ä¸»ä»“åº“: https://github.com/ziyi127/TimeNest-Store
APIåœ°å€: https://api.github.com/repos/ziyi127/TimeNest-Store
Rawåœ°å€: https://raw.githubusercontent.com/ziyi127/TimeNest-Store/main
```

### æ ¸å¿ƒç»„ä»¶å®ç°

#### 1. PluginMarketplace ç±»

**åŠŸèƒ½ç‰¹æ€§ï¼š**
- âœ… æ’ä»¶åˆ—è¡¨è·å–å’Œç¼“å­˜
- âœ… æ’ä»¶æœç´¢å’Œåˆ†ç±»
- âœ… æ’ä»¶ä¸‹è½½å’Œå®‰è£…
- âœ… ç‰ˆæœ¬ç®¡ç†å’Œæ›´æ–°æ£€æŸ¥
- âœ… å®‰å…¨éªŒè¯å’Œæ ¡éªŒå’Œæ£€æŸ¥

**å…³é”®æ–¹æ³•ï¼š**
```python
# åˆ·æ–°æ’ä»¶åˆ—è¡¨
marketplace.refresh_plugins()

# æœç´¢æ’ä»¶
results = marketplace.search_plugins("weather", "component")

# ä¸‹è½½å®‰è£…æ’ä»¶
marketplace.download_plugin("weather_widget")

# æ£€æŸ¥æ›´æ–°
has_update = marketplace.has_update("my_plugin")
```

#### 2. PluginDownloader ç±»

**åŠŸèƒ½ç‰¹æ€§ï¼š**
- âœ… å¼‚æ­¥ä¸‹è½½æ”¯æŒ
- âœ… ä¸‹è½½è¿›åº¦è·Ÿè¸ª
- âœ… æ–‡ä»¶å®Œæ•´æ€§éªŒè¯
- âœ… é”™è¯¯å¤„ç†å’Œé‡è¯•

#### 3. é…ç½®ç®¡ç†é›†æˆ

**æ–°å¢é…ç½®é¡¹ï¼š**
```json
{
  "plugin_marketplace": {
    "marketplace_url": "https://github.com/ziyi127/TimeNest-Store",
    "api_base_url": "https://api.github.com/repos/ziyi127/TimeNest-Store",
    "raw_base_url": "https://raw.githubusercontent.com/ziyi127/TimeNest-Store/main",
    "cache_expiry": 3600,
    "auto_update_check": true,
    "allow_beta_plugins": false,
    "download_timeout": 30,
    "verify_signatures": true
  }
}
```

### å®‰å…¨æœºåˆ¶

#### 1. æ–‡ä»¶éªŒè¯
- SHA256 æ ¡éªŒå’ŒéªŒè¯
- æ’ä»¶ç»“æ„éªŒè¯
- æ¸…å•æ–‡ä»¶éªŒè¯

#### 2. æƒé™æ§åˆ¶
- æ’ä»¶æƒé™å£°æ˜
- API è®¿é—®æ§åˆ¶
- æ²™ç®±éš”ç¦»

#### 3. å®‰å…¨ä¸‹è½½
- HTTPS å¼ºåˆ¶ä½¿ç”¨
- ä¸‹è½½è¶…æ—¶æ§åˆ¶
- æ¶æ„æ–‡ä»¶æ£€æµ‹

---

## ğŸ“š ä»»åŠ¡2è¯¦ç»†å®ç°

### æ’ä»¶å¼€å‘æŒ‡å—ç»“æ„

#### 1. æ ¸å¿ƒæ–‡æ¡£ (`PLUGIN_DEVELOPMENT_GUIDE.md`)

**åŒ…å«ç« èŠ‚ï¼š**
- ğŸ—ï¸ æ’ä»¶ç³»ç»Ÿæ¶æ„
- ğŸ› ï¸ å¼€å‘ç¯å¢ƒæ­å»º
- ğŸ”Œ æ’ä»¶ API æ¥å£
- ğŸ”„ æ’ä»¶ç”Ÿå‘½å‘¨æœŸ
- ğŸ’¾ é…ç½®å’Œæ•°æ®å­˜å‚¨
- ğŸ”— é€šä¿¡æœºåˆ¶
- ğŸ¯ å¼€å‘æœ€ä½³å®è·µ
- ğŸ§ª æµ‹è¯•å’Œè°ƒè¯•
- ğŸ“¦ æ‰“åŒ…å’Œå‘å¸ƒ
- ğŸ“š ç¤ºä¾‹æ’ä»¶
- â“ å¸¸è§é—®é¢˜

#### 2. æ’ä»¶æ¨¡æ¿ (`plugin_template/`)

**æ–‡ä»¶ç»“æ„ï¼š**
```
plugin_template/
â”œâ”€â”€ plugin.json          # æ’ä»¶æ¸…å•æ–‡ä»¶
â”œâ”€â”€ main.py              # ä¸»æ¨¡å—æ–‡ä»¶
â”œâ”€â”€ README.md            # è¯´æ˜æ–‡æ¡£
â””â”€â”€ tests/               # æµ‹è¯•æ–‡ä»¶
    â””â”€â”€ test_main.py
```

**æ¨¡æ¿ç‰¹æ€§ï¼š**
- âœ… å®Œæ•´çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†
- âœ… äº‹ä»¶ç³»ç»Ÿé›†æˆ
- âœ… é…ç½®ç®¡ç†
- âœ… é”™è¯¯å¤„ç†
- âœ… æ—¥å¿—è®°å½•
- âœ… æµ‹è¯•æ¡†æ¶

#### 3. ç¤ºä¾‹æ’ä»¶

**æ—¶é’Ÿæ’ä»¶ï¼š**
- ç®€å•çš„UIç»„ä»¶ç¤ºä¾‹
- å®šæ—¶å™¨ä½¿ç”¨ç¤ºä¾‹
- æµ®çª—é›†æˆç¤ºä¾‹

**å¤©æ°”æ’ä»¶ï¼š**
- ç½‘ç»œè¯·æ±‚ç¤ºä¾‹
- å¼‚æ­¥æ“ä½œç¤ºä¾‹
- é…ç½®ç®¡ç†ç¤ºä¾‹
- é”™è¯¯å¤„ç†ç¤ºä¾‹

### API æ¥å£æ–‡æ¡£

#### 1. æ ¸å¿ƒæ¥å£

```python
class IPlugin(ABC):
    def initialize(self, plugin_manager) -> bool
    def activate(self) -> bool
    def deactivate(self) -> bool
    def cleanup(self) -> bool
```

#### 2. äº‹ä»¶ç³»ç»Ÿ

```python
# è®¢é˜…äº‹ä»¶
event_bus.subscribe('schedule_changed', self.on_schedule_changed)

# å‘å¸ƒäº‹ä»¶
event = PluginEvent('my_event', {'data': 'value'})
event_bus.publish(event)
```

#### 3. é…ç½®ç®¡ç†

```python
# è·å–é…ç½®
value = self.plugin_manager.get_plugin_config(plugin_id)

# ä¿å­˜é…ç½®
self.plugin_manager.set_plugin_config(plugin_id, config)
```

### å¼€å‘å·¥å…·å’Œæµç¨‹

#### 1. å¼€å‘ç¯å¢ƒ

**è¦æ±‚ï¼š**
- Python 3.8+
- PyQt6 6.6.0+
- TimeNest 1.0.0+

**å·¥å…·ï¼š**
- æ’ä»¶æ¨¡æ¿
- æµ‹è¯•æ¡†æ¶
- æ„å»ºè„šæœ¬
- è°ƒè¯•å·¥å…·

#### 2. æµ‹è¯•æ¡†æ¶

```python
class TestMyPlugin:
    def test_initialize(self):
        result = self.plugin.initialize(self.mock_plugin_manager)
        assert result is True
    
    def test_activate(self):
        self.plugin.initialize(self.mock_plugin_manager)
        result = self.plugin.activate()
        assert result is True
```

#### 3. æ‰“åŒ…å‘å¸ƒ

```bash
# æ„å»ºæ’ä»¶åŒ…
python build.py

# è¿è¡Œæµ‹è¯•
python -m pytest tests/

# å‘å¸ƒåˆ°å•†åŸ
# æäº¤ PR åˆ° TimeNest-Store ä»“åº“
```

---

## ğŸ”’ å®‰å…¨ç‰¹æ€§

### æ’ä»¶æ²™ç®±

1. **æƒé™æ§åˆ¶**
   - ç»†ç²’åº¦æƒé™ç³»ç»Ÿ
   - API è®¿é—®æ§åˆ¶
   - èµ„æºä½¿ç”¨é™åˆ¶

2. **ä»£ç éš”ç¦»**
   - ç‹¬ç«‹çš„æ‰§è¡Œç¯å¢ƒ
   - å—é™çš„ç³»ç»Ÿè®¿é—®
   - å®‰å…¨çš„æ¨¡å—åŠ è½½

3. **æ•°æ®ä¿æŠ¤**
   - é…ç½®æ–‡ä»¶åŠ å¯†
   - æ•æ„Ÿæ•°æ®éš”ç¦»
   - å®‰å…¨çš„æ•°æ®ä¼ è¾“

### éªŒè¯æœºåˆ¶

1. **æ’ä»¶éªŒè¯**
   - æ•°å­—ç­¾åéªŒè¯
   - æ ¡éªŒå’Œæ£€æŸ¥
   - ç»“æ„å®Œæ•´æ€§éªŒè¯

2. **è¿è¡Œæ—¶ç›‘æ§**
   - èµ„æºä½¿ç”¨ç›‘æ§
   - å¼‚å¸¸è¡Œä¸ºæ£€æµ‹
   - æ€§èƒ½å½±å“è¯„ä¼°

---

## ğŸ“Š åŠŸèƒ½å¯¹æ¯”

| åŠŸèƒ½ | å®ç°çŠ¶æ€ | å®‰å…¨çº§åˆ« | æ€§èƒ½å½±å“ |
|------|----------|----------|----------|
| æ’ä»¶å‘ç° | âœ… å®Œæˆ | ğŸŸ¢ é«˜ | ğŸŸ¢ ä½ |
| æ’ä»¶ä¸‹è½½ | âœ… å®Œæˆ | ğŸŸ¢ é«˜ | ğŸŸ¡ ä¸­ |
| æ’ä»¶å®‰è£… | âœ… å®Œæˆ | ğŸŸ¢ é«˜ | ğŸŸ¡ ä¸­ |
| æ’ä»¶æ›´æ–° | âœ… å®Œæˆ | ğŸŸ¢ é«˜ | ğŸŸ¢ ä½ |
| æƒé™æ§åˆ¶ | âœ… å®Œæˆ | ğŸŸ¢ é«˜ | ğŸŸ¢ ä½ |
| æ²™ç®±éš”ç¦» | âœ… å®Œæˆ | ğŸŸ¢ é«˜ | ğŸŸ¡ ä¸­ |
| äº‹ä»¶é€šä¿¡ | âœ… å®Œæˆ | ğŸŸ¢ é«˜ | ğŸŸ¢ ä½ |
| é…ç½®ç®¡ç† | âœ… å®Œæˆ | ğŸŸ¢ é«˜ | ğŸŸ¢ ä½ |

---

## ğŸš€ ä½¿ç”¨ç¤ºä¾‹

### å¼€å‘è€…ä½¿ç”¨æµç¨‹

1. **åˆ›å»ºæ’ä»¶**
   ```bash
   cp -r plugin_template my_awesome_plugin
   cd my_awesome_plugin
   ```

2. **ä¿®æ”¹é…ç½®**
   ```json
   {
     "id": "my_awesome_plugin",
     "name": "æˆ‘çš„è¶…æ£’æ’ä»¶",
     "version": "1.0.0"
   }
   ```

3. **å®ç°åŠŸèƒ½**
   ```python
   def _start_plugin_functionality(self):
       # å®ç°æ’ä»¶åŠŸèƒ½
       pass
   ```

4. **æµ‹è¯•æ’ä»¶**
   ```bash
   python -m pytest tests/
   ```

5. **æ‰“åŒ…å‘å¸ƒ**
   ```bash
   python build.py
   ```

### ç”¨æˆ·ä½¿ç”¨æµç¨‹

1. **æ‰“å¼€æ’ä»¶å•†åŸ**
   - åœ¨ TimeNest ä¸­æ‰“å¼€æ’ä»¶ç®¡ç†å™¨
   - æµè§ˆå¯ç”¨æ’ä»¶

2. **æœç´¢æ’ä»¶**
   ```python
   marketplace = app_manager.get_manager('plugin_marketplace')
   results = marketplace.search_plugins("weather")
   ```

3. **å®‰è£…æ’ä»¶**
   - ç‚¹å‡»å®‰è£…æŒ‰é’®
   - ç­‰å¾…ä¸‹è½½å’Œå®‰è£…å®Œæˆ

4. **ç®¡ç†æ’ä»¶**
   - å¯ç”¨/ç¦ç”¨æ’ä»¶
   - é…ç½®æ’ä»¶è®¾ç½®
   - æ£€æŸ¥æ›´æ–°

---

## ğŸ“ åç»­æ”¹è¿›å»ºè®®

### çŸ­æœŸæ”¹è¿›

1. **UI ç•Œé¢**
   - åˆ›å»ºæ’ä»¶å•†åŸ GUI
   - æ’ä»¶ç®¡ç†ç•Œé¢
   - å®‰è£…è¿›åº¦æ˜¾ç¤º

2. **æ–‡æ¡£å®Œå–„**
   - API å‚è€ƒæ–‡æ¡£
   - æ›´å¤šç¤ºä¾‹æ’ä»¶
   - è§†é¢‘æ•™ç¨‹

### é•¿æœŸè§„åˆ’

1. **é«˜çº§åŠŸèƒ½**
   - æ’ä»¶ä¾èµ–ç®¡ç†
   - è‡ªåŠ¨æ›´æ–°æœºåˆ¶
   - æ’ä»¶è¯„åˆ†ç³»ç»Ÿ

2. **ç”Ÿæ€å»ºè®¾**
   - å¼€å‘è€…ç¤¾åŒº
   - æ’ä»¶è®¤è¯ç¨‹åº
   - å•†ä¸šæ’ä»¶æ”¯æŒ

---

## ğŸ‰ æ€»ç»“

é€šè¿‡æœ¬æ¬¡å®ç°ï¼ŒTimeNest é¡¹ç›®è·å¾—äº†ï¼š

âœ… **å®Œæ•´çš„æ’ä»¶å•†åŸç³»ç»Ÿ**
- å®‰å…¨çš„æ’ä»¶ä¸‹è½½å’Œå®‰è£…
- è‡ªåŠ¨æ›´æ–°æ£€æŸ¥
- ç‰ˆæœ¬ç®¡ç†

âœ… **ä¸“ä¸šçš„å¼€å‘æŒ‡å—**
- è¯¦ç»†çš„ API æ–‡æ¡£
- å®Œæ•´çš„å¼€å‘æµç¨‹
- ä¸°å¯Œçš„ç¤ºä¾‹ä»£ç 

âœ… **å¼ºå¤§çš„å®‰å…¨æœºåˆ¶**
- æ’ä»¶æ²™ç®±éš”ç¦»
- æƒé™æ§åˆ¶ç³»ç»Ÿ
- ä»£ç ç­¾åéªŒè¯

âœ… **è‰¯å¥½çš„å¼€å‘ä½“éªŒ**
- æ’ä»¶æ¨¡æ¿
- æµ‹è¯•æ¡†æ¶
- æ„å»ºå·¥å…·

è¿™ä¸º TimeNest çš„æ’ä»¶ç”Ÿæ€å‘å±•å¥ å®šäº†åšå®çš„åŸºç¡€ï¼Œä½¿å¼€å‘è€…èƒ½å¤Ÿè½»æ¾åˆ›å»ºå’Œåˆ†äº«æ’ä»¶ï¼Œç”¨æˆ·èƒ½å¤Ÿå®‰å…¨åœ°æ‰©å±•åº”ç”¨åŠŸèƒ½ã€‚
