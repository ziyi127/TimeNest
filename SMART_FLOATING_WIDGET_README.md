# TimeNest æ™ºèƒ½æµ®çª—ç³»ç»Ÿ

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

TimeNest æ™ºèƒ½æµ®çª—ç³»ç»Ÿæ˜¯ä¸€ä¸ªä»¿è‹¹æœçµåŠ¨å²›ï¼ˆDynamic Islandï¼‰è®¾è®¡çš„åŠ¨æ€ä¿¡æ¯æ˜¾ç¤ºåŠŸèƒ½ï¼Œä¸º TimeNest é¡¹ç›®æä¾›äº†ç°ä»£åŒ–ã€ç¾è§‚çš„æµ®çª—ä½“éªŒã€‚

## âœ¨ æ ¸å¿ƒç‰¹æ€§

### ğŸ¨ è§†è§‰è®¾è®¡
- **ä»¿çµåŠ¨å²›å¤–è§‚**ï¼šåœ†è§’èƒ¶å›Šå½¢çŠ¶ï¼Œé»˜è®¤ 400Ã—60px
- **è‡ªé€‚åº”é€æ˜åº¦**ï¼š50%-100% å¯è°ƒï¼Œå®æ—¶é¢„è§ˆ
- **ä¸»é¢˜é›†æˆ**ï¼šè‡ªåŠ¨é€‚é…æµ…è‰²/æ·±è‰²ä¸»é¢˜
- **å¹³æ»‘åŠ¨ç”»**ï¼šæ˜¾ç¤º/éšè—/å†…å®¹åˆ‡æ¢åŠ¨ç”»
- **å§‹ç»ˆç½®é¡¶**ï¼šç¡®ä¿ä¿¡æ¯å§‹ç»ˆå¯è§

### ğŸ§© æ¨¡å—åŒ–æ¶æ„
- **æ—¶é—´æ˜¾ç¤ºæ¨¡å—**ï¼šæ”¯æŒ 12/24 å°æ—¶åˆ¶ï¼Œå¯æ˜¾ç¤ºç§’æ•°
- **è¯¾ç¨‹è¡¨æ¨¡å—**ï¼šæ˜¾ç¤ºå½“å‰è¯¾ç¨‹ã€æ•™å®¤ã€å‰©ä½™æ—¶é—´
- **å€’è®¡æ—¶æ¨¡å—**ï¼šé‡è¦äº‹ä»¶å€’è®¡æ—¶æé†’
- **å¤©æ°”ä¿¡æ¯æ¨¡å—**ï¼šå®æ—¶å¤©æ°”æ•°æ®ï¼ˆéœ€ API å¯†é’¥ï¼‰
- **ç³»ç»ŸçŠ¶æ€æ¨¡å—**ï¼šCPUã€å†…å­˜ä½¿ç”¨ç‡ç›‘æ§

### âš™ï¸ é«˜çº§åŠŸèƒ½
- **æ‹–æ‹½å®šä½**ï¼šæ”¯æŒè‡ªç”±æ‹–æ‹½å’Œç£æ€§å¸é™„
- **å³é”®èœå•**ï¼šå¿«é€Ÿè®¿é—®è®¾ç½®å’ŒåŠŸèƒ½
- **åŒå‡»äº¤äº’**ï¼šåŒå‡»æ‰“å¼€ä¸»çª—å£
- **è®¾ç½®ç•Œé¢**ï¼šå®Œæ•´çš„é…ç½®ç®¡ç†ç•Œé¢
- **æ€§èƒ½ä¼˜åŒ–**ï¼šä½ CPU ä½¿ç”¨ï¼Œæ™ºèƒ½æ›´æ–°ç­–ç•¥

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### ä¾èµ–æ³¨å…¥è®¾è®¡
```python
# ä¸¥æ ¼éµå¾ªæ— å¾ªç¯ä¾èµ–æ¶æ„
class SmartFloatingWidget(QWidget):
    def __init__(self, app_manager: AppManager):
        # é€šè¿‡æ„é€ å‡½æ•°æ³¨å…¥ä¾èµ–
        self.app_manager = app_manager
```

### æ¨¡å—ç³»ç»Ÿ
```python
# æŠ½è±¡åŸºç±»å®šä¹‰
class FloatingModule(QObject, ABC, metaclass=QObjectABCMeta):
    @abstractmethod
    def get_display_text(self) -> str: ...
    
    @abstractmethod
    def update_content(self) -> None: ...
```

### åŠ¨ç”»ç³»ç»Ÿ
```python
# ä¸“ä¸šåŠ¨ç”»ç®¡ç†
class FloatingAnimations(QObject):
    def slide_in_from_top(self): ...
    def fade_out(self): ...
    def smooth_resize(self): ...
```

## ğŸ“ æ–‡ä»¶ç»“æ„

```
ui/floating_widget/
â”œâ”€â”€ __init__.py                 # æ¨¡å—å¯¼å‡º
â”œâ”€â”€ smart_floating_widget.py    # ä¸»æµ®çª—ç»„ä»¶
â”œâ”€â”€ floating_modules.py         # åŠŸèƒ½æ¨¡å—å®ç°
â”œâ”€â”€ floating_settings.py        # è®¾ç½®ç•Œé¢
â””â”€â”€ animations.py              # åŠ¨ç”»ç³»ç»Ÿ
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. åŸºæœ¬ä½¿ç”¨
```python
from ui.floating_widget import SmartFloatingWidget

# åˆ›å»ºæ™ºèƒ½æµ®çª—ï¼ˆéœ€è¦ AppManager å®ä¾‹ï¼‰
smart_widget = SmartFloatingWidget(app_manager)

# æ˜¾ç¤ºæµ®çª—
smart_widget.show_with_animation()

# éšè—æµ®çª—
smart_widget.hide_with_animation()
```

### 2. é€šè¿‡ FloatingManager ä½¿ç”¨
```python
from core.floating_manager import FloatingManager

# åˆ›å»ºæµ®çª—ç®¡ç†å™¨
floating_manager = FloatingManager()
floating_manager.set_app_manager(app_manager)

# åˆ›å»ºå¹¶æ˜¾ç¤ºæ™ºèƒ½æµ®çª—
floating_manager.create_widget()
floating_manager.show_widget()

# æ˜¾ç¤ºè®¾ç½®å¯¹è¯æ¡†
floating_manager.show_settings_dialog()
```

### 3. è‡ªå®šä¹‰æ¨¡å—
```python
class CustomModule(FloatingModule):
    def __init__(self, app_manager=None):
        super().__init__('custom', app_manager)
    
    def get_display_text(self) -> str:
        return "è‡ªå®šä¹‰å†…å®¹"
    
    def update_content(self) -> None:
        # æ›´æ–°é€»è¾‘
        self.content_updated.emit(self.get_display_text())

# æ·»åŠ åˆ°æµ®çª—
smart_widget.add_module('custom', CustomModule(app_manager))
```

## âš™ï¸ é…ç½®é€‰é¡¹

### å¤–è§‚é…ç½®
```json
{
  "floating_widget": {
    "width": 400,
    "height": 60,
    "opacity": 0.9,
    "border_radius": 30,
    "position": {"x": 100, "y": 10},
    "animation_duration": 300
  }
}
```

### æ¨¡å—é…ç½®
```json
{
  "modules": {
    "time": {
      "enabled": true,
      "order": 0,
      "format_24h": true,
      "show_seconds": true
    },
    "weather": {
      "enabled": false,
      "api_key": "your_api_key",
      "city": "Beijing"
    }
  }
}
```

## ğŸ›ï¸ è®¾ç½®ç•Œé¢

### å¤–è§‚è®¾ç½®
- **é€æ˜åº¦æ»‘å—**ï¼šå®æ—¶è°ƒèŠ‚é€æ˜åº¦
- **å°ºå¯¸è®¾ç½®**ï¼šå®½åº¦ã€é«˜åº¦ã€åœ†è§’åŠå¾„
- **ä¸»é¢˜é€‰æ‹©**ï¼šè·Ÿéšç³»ç»Ÿ/æµ…è‰²/æ·±è‰²/è‡ªå®šä¹‰
- **é¢œè‰²é€‰æ‹©**ï¼šèƒŒæ™¯è‰²ã€æ–‡å­—è‰²è‡ªå®šä¹‰
- **å­—ä½“è®¾ç½®**ï¼šå­—ä½“æ—ã€å¤§å°ã€æ ·å¼

### æ¨¡å—ç®¡ç†
- **å¯ç”¨/ç¦ç”¨**ï¼šæ¯ä¸ªæ¨¡å—ç‹¬ç«‹æ§åˆ¶
- **æ‹–æ‹½æ’åº**ï¼šè°ƒæ•´æ¨¡å—æ˜¾ç¤ºé¡ºåº
- **æ¨¡å—è®¾ç½®**ï¼šæ¯ä¸ªæ¨¡å—çš„ä¸“å±é…ç½®

### é«˜çº§è®¾ç½®
- **ä½ç½®è®¾ç½®**ï¼šé¢„è®¾ä½ç½®æˆ–è‡ªå®šä¹‰åæ ‡
- **åŠ¨ç”»é…ç½®**ï¼šåŠ¨ç”»æ—¶é•¿ã€ç¼“åŠ¨æ›²çº¿
- **æ€§èƒ½é€‰é¡¹**ï¼šæ›´æ–°é¢‘ç‡ã€ä½ CPU æ¨¡å¼
- **å¯åŠ¨è®¾ç½®**ï¼šå¼€æœºè‡ªå¯ã€å¯åŠ¨æœ€å°åŒ–

## ğŸ§ª æµ‹è¯•éªŒè¯

### è¿è¡Œæµ‹è¯•
```bash
# å®Œæ•´æµ‹è¯•ï¼ˆåŒ…å« GUIï¼‰
python test_smart_floating_widget.py

# ä»…æ¨¡å—æµ‹è¯•ï¼ˆæ—  GUIï¼‰
python test_smart_floating_widget.py --no-gui
```

### æµ‹è¯•ç»“æœ
```
ğŸ‰ æ™ºèƒ½æµ®çª—ç³»ç»Ÿå¼€å‘æˆåŠŸï¼
âœ¨ ç³»ç»Ÿç‰¹æ€§:
  âœ“ ä»¿è‹¹æœçµåŠ¨å²›è®¾è®¡
  âœ“ æ¨¡å—åŒ–æ¶æ„
  âœ“ ä¾èµ–æ³¨å…¥æ¨¡å¼
  âœ“ åŠ¨ç”»æ•ˆæœç³»ç»Ÿ
  âœ“ å®Œæ•´è®¾ç½®ç•Œé¢
  âœ“ PyQt6 å…¼å®¹
  âœ“ æ— å¾ªç¯ä¾èµ–
```

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

- **CPU ä½¿ç”¨ç‡**ï¼šç©ºé—²æ—¶ < 1%ï¼Œæ›´æ–°æ—¶ < 5%
- **å†…å­˜å ç”¨**ï¼š< 50MB å¸¸é©»å†…å­˜
- **å¯åŠ¨æ—¶é—´**ï¼šæµ®çª—æ˜¾ç¤º < 500ms
- **å“åº”æ—¶é—´**ï¼šç”¨æˆ·äº¤äº’å“åº” < 100ms

## ğŸ”§ æŠ€æœ¯äº®ç‚¹

### 1. æ— å¾ªç¯ä¾èµ–æ¶æ„
- ä¸¥æ ¼éµå¾ªä¾èµ–æ³¨å…¥æ¨¡å¼
- ä½¿ç”¨ TYPE_CHECKING é¿å…è¿è¡Œæ—¶å¾ªç¯å¯¼å…¥
- å…¼å®¹çš„ metaclass è§£å†³ QObject å’Œ ABC å†²çª

### 2. PyQt6 å®Œå…¨å…¼å®¹
- ä½¿ç”¨æœ€æ–°çš„ PyQt6 API
- æ­£ç¡®å¤„ç†å·²å¼ƒç”¨çš„å±æ€§
- ç°ä»£åŒ–çš„ä¿¡å·æ§½æœºåˆ¶

### 3. æ¨¡å—åŒ–è®¾è®¡
- æŠ½è±¡åŸºç±»å®šä¹‰ç»Ÿä¸€æ¥å£
- æ’ä»¶å¼æ¨¡å—åŠ è½½
- ç‹¬ç«‹çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†

### 4. ä¸“ä¸šåŠ¨ç”»ç³»ç»Ÿ
- åŸºäº QPropertyAnimation
- å¤šç§ç¼“åŠ¨æ›²çº¿æ”¯æŒ
- å¹³æ»‘çš„è§†è§‰è¿‡æ¸¡æ•ˆæœ

## ğŸ› ï¸ å¼€å‘æŒ‡å—

### æ·»åŠ æ–°æ¨¡å—
1. ç»§æ‰¿ `FloatingModule` åŸºç±»
2. å®ç°å¿…è¦çš„æŠ½è±¡æ–¹æ³•
3. åœ¨è®¾ç½®ç•Œé¢æ·»åŠ é…ç½®é€‰é¡¹
4. æ³¨å†Œåˆ°æ¨¡å—ç®¡ç†å™¨

### è‡ªå®šä¹‰åŠ¨ç”»
1. æ‰©å±• `FloatingAnimations` ç±»
2. ä½¿ç”¨ QPropertyAnimation
3. è¿æ¥å®Œæˆä¿¡å·
4. å¤„ç†åŠ¨ç”»çŠ¶æ€

### ä¸»é¢˜é›†æˆ
1. ç›‘å¬ä¸»é¢˜å˜åŒ–ä¿¡å·
2. å®ç° `apply_theme` æ–¹æ³•
3. åŠ¨æ€æ›´æ–°é¢œè‰²å’Œæ ·å¼
4. ä¿æŒè§†è§‰ä¸€è‡´æ€§

## ğŸ› å·²çŸ¥é—®é¢˜

1. **å¤©æ°”æ¨¡å—**ï¼šéœ€è¦æœ‰æ•ˆçš„ API å¯†é’¥
2. **ç³»ç»ŸçŠ¶æ€**ï¼šLinux ä¸‹éœ€è¦ psutil æƒé™
3. **TTS åŠŸèƒ½**ï¼šéœ€è¦ç³»ç»Ÿè¯­éŸ³æ”¯æŒ

## ğŸ”® æœªæ¥è§„åˆ’

- [ ] æ›´å¤šå†…ç½®æ¨¡å—ï¼ˆéŸ³ä¹ã€é€šçŸ¥ç­‰ï¼‰
- [ ] æ’ä»¶ç³»ç»Ÿæ”¯æŒ
- [ ] å¤šæ˜¾ç¤ºå™¨é€‚é…
- [ ] æ‰‹åŠ¿æ§åˆ¶
- [ ] äº‘åŒæ­¥é…ç½®

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®éµå¾ª TimeNest é¡¹ç›®çš„è®¸å¯è¯åè®®ã€‚

---

**å¼€å‘å®Œæˆæ—¶é—´**ï¼š2025-07-11  
**ç‰ˆæœ¬**ï¼šv1.0.0  
**å…¼å®¹æ€§**ï¼šPyQt6, Python 3.8+
