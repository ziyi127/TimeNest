# GitHub Actions 自动构建配置

本项目配置了GitHub Actions工作流，用于自动编译TimeNest应用程序并生成可执行文件。

## 工作流概述

### 1. 自动编译和发布 (`auto-build.yml`)

**触发条件：**
- 推送到 `main` 或 `develop` 分支
- 创建版本标签 (`v*.*.*`)
- 向 `main` 或 `develop` 分支提交拉取请求
- 手动触发 (`workflow_dispatch`)

**构建环境：**
- Windows Server 2022 (60分钟超时)
- Ubuntu Latest (30分钟超时)
- Python 3.11 (避免3.13的兼容性问题)

**主要功能：**
- ✅ 使用Nuitka 2.4.11进行编译
- ✅ 缓存pip依赖和Nuitka构建缓存
- ✅ 生成Windows和Linux可执行文件
- ✅ 自动创建压缩分发包
- ✅ 详细的构建摘要和错误处理

### 2. 发布到Release (`release.yml`)

**触发条件：**
- 创建版本标签 (`v*.*.*`)

**主要功能：**
- ✅ 自动下载构建产物
- ✅ 创建GitHub Release
- ✅ 上传Windows和Linux可执行文件
- ✅ 自动生成Release说明
- ✅ 改进的artifact处理逻辑

### 3. 测试构建 (`test-build.yml`)

**触发条件：**
- 推送到 `feature/*` 或 `fix/*` 分支
- 向 `develop` 分支提交拉取请求
- 手动触发

**测试内容：**
- ✅ 多Python版本兼容性测试 (3.10, 3.11)
- ✅ 依赖安装验证
- ✅ 模块导入测试
- ✅ 语法检查

## 构建优化特性

### 性能优化
- **缓存机制**: pip依赖和Nuitka构建缓存
- **并行构建**: 多操作系统同时构建
- **超时控制**: 防止构建过程无限等待
- **链接时优化**: 启用LTO减小文件大小

### 稳定性增强
- **版本锁定**: 使用特定版本的Nuitka (2.4.11)
- **错误处理**: 详细的错误检测和恢复机制
- **文件验证**: 自动验证生成的可执行文件
- **构建摘要**: 详细的构建状态报告

### 输出优化
- **文件命名**: 统一的输出文件名 (TimeNest.exe/TimeNest)
- **压缩包**: 自动创建分发压缩包
- **版本信息**: 包含构建时间和提交信息的Release说明

## 使用说明

### 手动触发构建
1. 进入GitHub仓库的Actions页面
2. 选择"自动编译和发布"工作流
3. 点击"Run workflow"按钮
4. 选择目标分支并运行

### 下载构建产物
1. 在工作流运行完成后
2. 进入具体的workflow运行页面
3. 在"Artifacts"部分下载对应系统的构建产物

### 创建发布版本
1. 创建并推送版本标签:
   ```bash
   git tag v1.0.0
   git push origin v1.0.0
   ```
2. GitHub Actions会自动创建Release并上传构建产物

## 故障排除

### 构建失败的常见原因
1. **依赖问题**: 检查requirements.txt是否正确
2. **Nuitka版本**: 确保使用兼容的Nuitka版本
3. **超时**: 复杂项目可能需要调整超时时间
4. **权限问题**: 检查GitHub Token权限设置

### 构建日志查看
1. 进入GitHub仓库的Actions页面
2. 点击失败的工作流运行
3. 查看具体的步骤日志进行故障排查

## 配置自定义

### 修改构建参数
编辑 `build_with_nuitka.py` 文件可以调整:
- Nuitka编译参数
- 包含/排除的模块
- 数据文件列表
- 输出配置

### 调整触发条件
编辑 `.github/workflows/auto-build.yml` 可以修改:
- 触发分支
- 构建矩阵
- 超时时间
- 缓存策略

### 添加新平台
要添加新的构建平台，需要在workflow文件中:
1. 添加新的操作系统到matrix
2. 配置对应的构建步骤
3. 设置相应的产物打包方式

## 最佳实践

1. **定期更新依赖**: 保持Nuitka和相关依赖的最新版本
2. **测试分支**: 在feature分支充分测试后再合并到main
3. **版本管理**: 使用语义化版本号进行发布
4. **构建缓存**: 合理利用缓存机制提高构建速度
5. **错误监控**: 关注构建失败通知并及时处理