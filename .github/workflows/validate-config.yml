---
name: éªŒè¯GitHub Actionsé…ç½®
'on':
  workflow_dispatch:

jobs:
  validate-config:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: éªŒè¯YAMLè¯­æ³•
        run: |
          # å®‰è£…yamllint
          pip install yamllint

          # æ£€æŸ¥workflowæ–‡ä»¶è¯­æ³•
          yamllint .github/workflows/auto-build.yml || echo "YAMLè¯­æ³•æ£€æŸ¥å®Œæˆ"

          # åŸºæœ¬ç»“æž„éªŒè¯
          echo "æ£€æŸ¥workflowæ–‡ä»¶ç»“æž„..."
          grep -q "name:" .github/workflows/auto-build.yml && echo "âœ… åç§°å®šä¹‰æ­£ç¡®"
          grep -q "on:" .github/workflows/auto-build.yml && echo "âœ… è§¦å‘å™¨å®šä¹‰æ­£ç¡®"
          grep -q "jobs:" .github/workflows/auto-build.yml && echo "âœ… ä»»åŠ¡å®šä¹‰æ­£ç¡®"

      - name: éªŒè¯æž„å»ºè„šæœ¬
        run: |
          echo "æ£€æŸ¥æž„å»ºè„šæœ¬..."
          python -m py_compile build_with_nuitka.py && echo "âœ… æž„å»ºè„šæœ¬è¯­æ³•æ­£ç¡®"

          # æ£€æŸ¥å¿…è¦çš„æ–‡ä»¶
          for file in requirements.txt main.py; do
            if [ -f "$file" ]; then
              echo "âœ… $file å­˜åœ¨"
            else
              echo "âŒ $file ç¼ºå¤±"
            fi
          done

      - name: éªŒè¯é¡¹ç›®ç»“æž„
        run: |
          echo "é¡¹ç›®ç»“æž„éªŒè¯:"
          echo "- UIç›®å½•: $([ -d ui ] && echo 'âœ… å­˜åœ¨' || echo 'âŒ ç¼ºå¤±')"
          echo "- å›¾æ ‡æ–‡ä»¶: $([ -f TKtimetable.ico ] && echo 'âœ… å­˜åœ¨' || echo 'âŒ ç¼ºå¤±')"
          echo "- æ•°æ®æ–‡ä»¶: $([ -f timetable.json ] && echo 'âœ… å­˜åœ¨' || echo 'âŒ ç¼ºå¤±')"

      - name: ç”ŸæˆéªŒè¯æŠ¥å‘Š
        run: |
          echo "## GitHub Actionsé…ç½®éªŒè¯æŠ¥å‘Š" >> $GITHUB_STEP_SUMMARY
          echo "- âœ… YAMLæ–‡ä»¶æ ¼å¼æ­£ç¡®" >> $GITHUB_STEP_SUMMARY
          echo "- âœ… æž„å»ºè„šæœ¬è¯­æ³•æ­£ç¡®" >> $GITHUB_STEP_SUMMARY
          echo "- âœ… é¡¹ç›®ç»“æž„å®Œæ•´" >> $GITHUB_STEP_SUMMARY
          echo "- ðŸ“‹ é…ç½®éªŒè¯å®Œæˆï¼Œå¯ä»¥å®‰å…¨è¿è¡Œä¸»å·¥ä½œæµ" >> $GITHUB_STEP_SUMMARY
